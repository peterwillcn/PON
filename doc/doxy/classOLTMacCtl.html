<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>EPONImplementationforOMNet++: OLTMacCtl Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>OLTMacCtl Class Reference</h1><!-- doxytag: class="OLTMacCtl" -->
<p><a class="el" href="classOLTMacCtl.html" title="OLTMacCtl class controls the below MAC layer transmission times.">OLTMacCtl</a> class controls the below MAC layer transmission times.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;OLTMacCtl.h&gt;</code></p>

<p><a href="classOLTMacCtl-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a7c4ca0f13fdee2fe0a9bf444437f1cfb">~OLTMacCtl</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#aecac011afb34b02cd9e51668cccb83cf">initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a85e03d184585f059b9f93bc5c1fa2d79">handleMessage</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a8428d62034c65c7f747e633bff281433">processFrameFromHigherLayer</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a77958773a53e47ed85989ce74442e4b2">processFrameFromMAC</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a3ef7dbc5df9e0c4d04a0d2dd03f23685">clockSync</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#aa4822054e9be311918d6b8ed38846515">handleTxEnd</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a21a96603c81e4eb0d69a56ef58764c51">doTransmit</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle transmissions and queue.  <a href="#a21a96603c81e4eb0d69a56ef58764c51"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual cModule *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a13052373f6b6f10fbe769d58bc6c7af6">getNeighbourOnGate</a> (const char *gate)</td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a1853aa48e84b0ecf90b3ebf2e314e093">clock_reg</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">IPassiveQueue *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#adc1ff3a87f06a948bf7ffdf3f1f0d85a">queue_mod</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cQueue&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#ab5c536ec572c30d21e8693182e9422a2">tmp_queue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#ae085e3f2481867d641bc7482594a30f8">transmitState</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a050f1b0fbe6e725bc282b6ad0faf6aa8">txEnd</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a269ef95d4467c4248669f0405ec48fb0">numFramesFromHL</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTMacCtl.html#a6990ae3875de96704c5dc438bd60d11c">numFramesFromLL</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p><a class="el" href="classOLTMacCtl.html" title="OLTMacCtl class controls the below MAC layer transmission times.">OLTMacCtl</a> class controls the below MAC layer transmission times. </p>
<p>For the OLT is simpler since we continuously transmit. This class has a pointer to the EPON_Q_mgmt module and it uses it as a simple queue in order to get frames. Finally note that missing mac addresses and LLIDs (from frames) are filled in here, cause the lower layer expects them. </p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a7c4ca0f13fdee2fe0a9bf444437f1cfb"></a><!-- doxytag: member="OLTMacCtl::~OLTMacCtl" ref="a7c4ca0f13fdee2fe0a9bf444437f1cfb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">OLTMacCtl::~OLTMacCtl </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00021"></a>00021                      {
<a name="l00022"></a>00022         cancelAndDelete(<a class="code" href="classOLTMacCtl.html#a050f1b0fbe6e725bc282b6ad0faf6aa8">txEnd</a>);
<a name="l00023"></a>00023 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a3ef7dbc5df9e0c4d04a0d2dd03f23685"></a><!-- doxytag: member="OLTMacCtl::clockSync" ref="a3ef7dbc5df9e0c4d04a0d2dd03f23685" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OLTMacCtl::clockSync </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00170"></a>00170                          {
<a name="l00171"></a>00171         uint32_t simT = <a class="code" href="classMPCPTools.html#acb405d0b706b3d106604fdc8f442de9d">MPCPTools::simTimeToNS16</a>();
<a name="l00172"></a>00172         <a class="code" href="classOLTMacCtl.html#a1853aa48e84b0ecf90b3ebf2e314e093">clock_reg</a>=simT%<a class="code" href="MPCPTools_8h.html#a7a11b1805a8a4c73e5b844a12b98a531">MPCP_CLOCK_MAX</a>;
<a name="l00173"></a>00173 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a21a96603c81e4eb0d69a56ef58764c51"></a><!-- doxytag: member="OLTMacCtl::doTransmit" ref="a21a96603c81e4eb0d69a56ef58764c51" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OLTMacCtl::doTransmit </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle transmissions and queue. </p>

<p><div class="fragment"><pre class="fragment"><a name="l00116"></a>00116                                         {
<a name="l00117"></a>00117         cPacket * packet = check_and_cast&lt;cPacket *&gt;(msg);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119         <span class="keywordflow">if</span> (!packet)
<a name="l00120"></a>00120                         error(<span class="stringliteral">&quot;Queue module returned NULL frame&quot;</span>);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <span class="comment">// Calculate TX and remaining time</span>
<a name="l00124"></a>00124         <span class="comment">// NOTE: Change here for more bandwidth</span>
<a name="l00125"></a>00125         uint64_t txrate=GIGABIT_ETHERNET_TXRATE;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         uint32_t nextMsgSize =  packet-&gt;getByteLength();
<a name="l00128"></a>00128         <span class="keywordflow">if</span> (nextMsgSize == 0) {
<a name="l00129"></a>00129                 error(<span class="stringliteral">&quot;Message size 0&quot;</span>);
<a name="l00130"></a>00130         }
<a name="l00131"></a>00131         uint32_t bytes=nextMsgSize+PREAMBLE_BYTES+SFD_BYTES;
<a name="l00132"></a>00132         bytes+=INTERFRAME_GAP_BITS/8;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         <span class="comment">// TODO: Add laser on/off delay</span>
<a name="l00136"></a>00136         simtime_t timereq= ((double)(bytes*8)/txrate);
<a name="l00137"></a>00137         EV &lt;&lt; <span class="stringliteral">&quot;Bytes: &quot;</span>&lt;&lt;bytes&lt;&lt;<span class="stringliteral">&quot; bits: &quot;</span>&lt;&lt;bytes*8&lt;&lt;<span class="stringliteral">&quot; TX RATE: &quot;</span>&lt;&lt;txrate&lt;&lt;endl;
<a name="l00138"></a>00138         EV &lt;&lt; <span class="stringliteral">&quot;TX State: &quot;</span>&lt;&lt;<a class="code" href="classOLTMacCtl.html#ae085e3f2481867d641bc7482594a30f8">transmitState</a>&lt;&lt;endl;
<a name="l00139"></a>00139         EV &lt;&lt; <span class="stringliteral">&quot;Scheduled after &quot;</span>&lt;&lt;(double)(bytes*8)/txrate&lt;&lt;<span class="stringliteral">&quot;ns&quot;</span>&lt;&lt;endl;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141         <span class="keywordflow">if</span> (<a class="code" href="classOLTMacCtl.html#ae085e3f2481867d641bc7482594a30f8">transmitState</a> == <a class="code" href="OLTMacCtl_8h.html#a8466586b863fc4b1722eda703698d847">TX_IDLE</a>){
<a name="l00142"></a>00142                 <a class="code" href="classOLTMacCtl.html#ae085e3f2481867d641bc7482594a30f8">transmitState</a>=<a class="code" href="OLTMacCtl_8h.html#a972946de9120e4fa114e46e33de9a968">TX_SENDING</a>;
<a name="l00143"></a>00143                 <span class="comment">// Calculate the tx time</span>
<a name="l00144"></a>00144                 EV &lt;&lt; <span class="stringliteral">&quot;EndTx Scheduled after &quot;</span>&lt;&lt; timereq.raw() &lt;&lt; <span class="stringliteral">&quot; time_now: &quot;</span>&lt;&lt;simTime().raw()&lt;&lt;endl;
<a name="l00145"></a>00145                 scheduleAt(simTime()+timereq, <a class="code" href="classOLTMacCtl.html#a050f1b0fbe6e725bc282b6ad0faf6aa8">txEnd</a>);
<a name="l00146"></a>00146                 EV &lt;&lt; <span class="stringliteral">&quot; Sending...&quot;</span>&lt;&lt;endl;
<a name="l00147"></a>00147                 send(msg, <span class="stringliteral">&quot;lowerLayerOut&quot;</span>);
<a name="l00148"></a>00148         }
<a name="l00149"></a>00149         <span class="keywordflow">else</span>{
<a name="l00150"></a>00150                 error (<span class="stringliteral">&quot;OLTMacCtl: Packet Arrived from higher layer&quot;</span>
<a name="l00151"></a>00151                                 <span class="stringliteral">&quot;while we where in transmission. This should never happen&quot;</span>
<a name="l00152"></a>00152                                 <span class="stringliteral">&quot;(normally).&quot;</span>);
<a name="l00153"></a>00153         }
<a name="l00154"></a>00154 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a13052373f6b6f10fbe769d58bc6c7af6"></a><!-- doxytag: member="OLTMacCtl::getNeighbourOnGate" ref="a13052373f6b6f10fbe769d58bc6c7af6" args="(const char *gate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cModule * OLTMacCtl::getNeighbourOnGate </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>gate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00177"></a>00177                                                      {
<a name="l00178"></a>00178         <span class="keywordflow">return</span> gate(g)-&gt;getNextGate()-&gt;getOwnerModule();
<a name="l00179"></a>00179 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a85e03d184585f059b9f93bc5c1fa2d79"></a><!-- doxytag: member="OLTMacCtl::handleMessage" ref="a85e03d184585f059b9f93bc5c1fa2d79" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OLTMacCtl::handleMessage </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00047"></a>00047 {
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         <span class="comment">// Do clock_reg sync</span>
<a name="l00050"></a>00050         <a class="code" href="classOLTMacCtl.html#a3ef7dbc5df9e0c4d04a0d2dd03f23685">clockSync</a>();
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="comment">// Self Message</span>
<a name="l00053"></a>00053         <span class="keywordflow">if</span> (msg-&gt;isSelfMessage())
<a name="l00054"></a>00054         {
<a name="l00055"></a>00055                 EV &lt;&lt; <span class="stringliteral">&quot;Self-message &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; received\n&quot;</span>;
<a name="l00056"></a>00056                 <span class="keywordflow">if</span> (msg-&gt;getKind() == <a class="code" href="OLTMacCtl_8h.html#a6471ede2ce4a57ea91e04fb97d558c80">TXENDMSG</a>)
<a name="l00057"></a>00057                         <a class="code" href="classOLTMacCtl.html#aa4822054e9be311918d6b8ed38846515">handleTxEnd</a>();
<a name="l00058"></a>00058                 <span class="keywordflow">else</span>
<a name="l00059"></a>00059                         EV &lt;&lt; <span class="stringliteral">&quot;UnKnown Self Message\n&quot;</span>;
<a name="l00060"></a>00060 
<a name="l00061"></a>00061                 <span class="keywordflow">return</span>;
<a name="l00062"></a>00062         }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066         <span class="comment">// Network Message</span>
<a name="l00067"></a>00067         cGate *ingate = msg-&gt;getArrivalGate();
<a name="l00068"></a>00068         EV &lt;&lt; <span class="stringliteral">&quot;Frame &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; arrived on port &quot;</span> &lt;&lt; ingate-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;...\n&quot;</span>;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <span class="keywordflow">if</span> (ingate-&gt;getId() ==  gate( <span class="stringliteral">&quot;lowerLayerIn&quot;</span>)-&gt;getId()){
<a name="l00073"></a>00073                 <a class="code" href="classOLTMacCtl.html#a77958773a53e47ed85989ce74442e4b2">processFrameFromMAC</a>(msg);
<a name="l00074"></a>00074         }
<a name="l00075"></a>00075         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ingate-&gt;getId() ==  gate( <span class="stringliteral">&quot;upperLayerIn&quot;</span>)-&gt;getId()){
<a name="l00076"></a>00076                 <a class="code" href="classOLTMacCtl.html#a8428d62034c65c7f747e633bff281433">processFrameFromHigherLayer</a>(msg);
<a name="l00077"></a>00077         }<span class="keywordflow">else</span>{
<a name="l00078"></a>00078                 EV &lt;&lt; <span class="stringliteral">&quot;OLTMacCtl: Message came FROM THE WRONG DIRRECTION???? Dropping\n&quot;</span>;
<a name="l00079"></a>00079                 <span class="keyword">delete</span> msg;
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa4822054e9be311918d6b8ed38846515"></a><!-- doxytag: member="OLTMacCtl::handleTxEnd" ref="aa4822054e9be311918d6b8ed38846515" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OLTMacCtl::handleTxEnd </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00157"></a>00157                            {
<a name="l00158"></a>00158         <a class="code" href="classOLTMacCtl.html#ae085e3f2481867d641bc7482594a30f8">transmitState</a>=<a class="code" href="OLTMacCtl_8h.html#a8466586b863fc4b1722eda703698d847">TX_IDLE</a>;
<a name="l00159"></a>00159         <span class="keywordflow">if</span> (<a class="code" href="classOLTMacCtl.html#ab5c536ec572c30d21e8693182e9422a2">tmp_queue</a>.isEmpty()) {
<a name="l00160"></a>00160                 <a class="code" href="classOLTMacCtl.html#adc1ff3a87f06a948bf7ffdf3f1f0d85a">queue_mod</a>-&gt;requestPacket();
<a name="l00161"></a>00161                 <span class="keywordflow">return</span>;
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <a class="code" href="classOLTMacCtl.html#a21a96603c81e4eb0d69a56ef58764c51" title="Handle transmissions and queue.">doTransmit</a>(dynamic_cast&lt;cMessage *&gt;(<a class="code" href="classOLTMacCtl.html#ab5c536ec572c30d21e8693182e9422a2">tmp_queue</a>.pop()) );
<a name="l00165"></a>00165 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aecac011afb34b02cd9e51668cccb83cf"></a><!-- doxytag: member="OLTMacCtl::initialize" ref="aecac011afb34b02cd9e51668cccb83cf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OLTMacCtl::initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00026"></a>00026 {
<a name="l00027"></a>00027         <a class="code" href="classOLTMacCtl.html#a1853aa48e84b0ecf90b3ebf2e314e093">clock_reg</a>=0;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029         <span class="comment">// Watch the clock!!!</span>
<a name="l00030"></a>00030         <span class="comment">// (AND TRY NOT TO TOUCH IT)</span>
<a name="l00031"></a>00031     WATCH(<a class="code" href="classOLTMacCtl.html#a1853aa48e84b0ecf90b3ebf2e314e093">clock_reg</a>);
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034     <a class="code" href="classOLTMacCtl.html#a050f1b0fbe6e725bc282b6ad0faf6aa8">txEnd</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;TxEnd&quot;</span>,<a class="code" href="OLTMacCtl_8h.html#a6471ede2ce4a57ea91e04fb97d558c80">TXENDMSG</a>);
<a name="l00035"></a>00035     <a class="code" href="classOLTMacCtl.html#ae085e3f2481867d641bc7482594a30f8">transmitState</a>=<a class="code" href="OLTMacCtl_8h.html#a8466586b863fc4b1722eda703698d847">TX_IDLE</a>;
<a name="l00036"></a>00036     WATCH(<a class="code" href="classOLTMacCtl.html#ae085e3f2481867d641bc7482594a30f8">transmitState</a>);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 
<a name="l00039"></a>00039     <span class="comment">// Initialize the Q mgmt module</span>
<a name="l00040"></a>00040     <a class="code" href="classOLTMacCtl.html#adc1ff3a87f06a948bf7ffdf3f1f0d85a">queue_mod</a> = <span class="keyword">dynamic_cast&lt;</span>IPassiveQueue *<span class="keyword">&gt;</span>(<a class="code" href="classOLTMacCtl.html#a13052373f6b6f10fbe769d58bc6c7af6">getNeighbourOnGate</a>(<span class="stringliteral">&quot;upperLayerOut&quot;</span>));
<a name="l00041"></a>00041     <span class="keywordflow">if</span> (!<a class="code" href="classOLTMacCtl.html#adc1ff3a87f06a948bf7ffdf3f1f0d85a">queue_mod</a>)
<a name="l00042"></a>00042                 error(<span class="stringliteral">&quot;ONUMacCtl: A IPassiveQueue is needed above mac control&quot;</span>);
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8428d62034c65c7f747e633bff281433"></a><!-- doxytag: member="OLTMacCtl::processFrameFromHigherLayer" ref="a8428d62034c65c7f747e633bff281433" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OLTMacCtl::processFrameFromHigherLayer </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00083"></a>00083                                                         {
<a name="l00084"></a>00084         EV &lt;&lt; <span class="stringliteral">&quot;OLTMacCtl: Incoming to PON area...\n&quot;</span>;
<a name="l00085"></a>00085         EthernetIIFrame * frame = <span class="keyword">dynamic_cast&lt;</span>EthernetIIFrame *<span class="keyword">&gt;</span>(msg);
<a name="l00086"></a>00086         <span class="keywordflow">if</span> (frame &amp;&amp; frame-&gt;getEtherType() == <a class="code" href="MPCP__codes_8h.html#a01d93522186165aff8e9d9907b04aec3">MPCP_TYPE</a>){
<a name="l00087"></a>00087                 <a class="code" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> * mpcp = check_and_cast&lt;<a class="code" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> *&gt;(msg);
<a name="l00088"></a>00088                 mpcp-&gt;<a class="code" href="classMPCP.html#ae7828b734088f73c3b55adf0dfc1197e">setTs</a>(<a class="code" href="classMPCPTools.html#acb405d0b706b3d106604fdc8f442de9d">MPCPTools::simTimeToNS16</a>());
<a name="l00089"></a>00089         }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 
<a name="l00092"></a>00092         EV &lt;&lt; <span class="stringliteral">&quot;OLTMacCtl::Enqueue Frame&quot;</span> &lt;&lt;endl;
<a name="l00093"></a>00093         <a class="code" href="classOLTMacCtl.html#ab5c536ec572c30d21e8693182e9422a2">tmp_queue</a>.insert(msg);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         <span class="comment">// handle tx end will react like</span>
<a name="l00097"></a>00097         <span class="comment">// a transmission just finished ==</span>
<a name="l00098"></a>00098         <span class="comment">// check the Q module and keep on sending.</span>
<a name="l00099"></a>00099         <span class="keywordflow">if</span> (<a class="code" href="classOLTMacCtl.html#ae085e3f2481867d641bc7482594a30f8">transmitState</a> == <a class="code" href="OLTMacCtl_8h.html#a8466586b863fc4b1722eda703698d847">TX_IDLE</a>){
<a name="l00100"></a>00100                 EV &lt;&lt; <span class="stringliteral">&quot;OLTMacCtl::We where IDLE... starting transmission&quot;</span> &lt;&lt;endl;
<a name="l00101"></a>00101                 <a class="code" href="classOLTMacCtl.html#aa4822054e9be311918d6b8ed38846515">handleTxEnd</a>();
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a77958773a53e47ed85989ce74442e4b2"></a><!-- doxytag: member="OLTMacCtl::processFrameFromMAC" ref="a77958773a53e47ed85989ce74442e4b2" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OLTMacCtl::processFrameFromMAC </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00105"></a>00105                                                 {
<a name="l00106"></a>00106         EV &lt;&lt; <span class="stringliteral">&quot;OLTMacCtl: Message from PON area, forwarding to higher layer\n&quot;</span>;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108         <span class="comment">// Not Control</span>
<a name="l00109"></a>00109         send(msg,<span class="stringliteral">&quot;upperLayerOut&quot;</span>);
<a name="l00110"></a>00110         <a class="code" href="classOLTMacCtl.html#a6990ae3875de96704c5dc438bd60d11c">numFramesFromLL</a>++;
<a name="l00111"></a>00111 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a1853aa48e84b0ecf90b3ebf2e314e093"></a><!-- doxytag: member="OLTMacCtl::clock_reg" ref="a1853aa48e84b0ecf90b3ebf2e314e093" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classOLTMacCtl.html#a1853aa48e84b0ecf90b3ebf2e314e093">OLTMacCtl::clock_reg</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a269ef95d4467c4248669f0405ec48fb0"></a><!-- doxytag: member="OLTMacCtl::numFramesFromHL" ref="a269ef95d4467c4248669f0405ec48fb0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classOLTMacCtl.html#a269ef95d4467c4248669f0405ec48fb0">OLTMacCtl::numFramesFromHL</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a6990ae3875de96704c5dc438bd60d11c"></a><!-- doxytag: member="OLTMacCtl::numFramesFromLL" ref="a6990ae3875de96704c5dc438bd60d11c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classOLTMacCtl.html#a6990ae3875de96704c5dc438bd60d11c">OLTMacCtl::numFramesFromLL</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="adc1ff3a87f06a948bf7ffdf3f1f0d85a"></a><!-- doxytag: member="OLTMacCtl::queue_mod" ref="adc1ff3a87f06a948bf7ffdf3f1f0d85a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">IPassiveQueue* <a class="el" href="classOLTMacCtl.html#adc1ff3a87f06a948bf7ffdf3f1f0d85a">OLTMacCtl::queue_mod</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab5c536ec572c30d21e8693182e9422a2"></a><!-- doxytag: member="OLTMacCtl::tmp_queue" ref="ab5c536ec572c30d21e8693182e9422a2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cQueue <a class="el" href="classOLTMacCtl.html#ab5c536ec572c30d21e8693182e9422a2">OLTMacCtl::tmp_queue</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ae085e3f2481867d641bc7482594a30f8"></a><!-- doxytag: member="OLTMacCtl::transmitState" ref="ae085e3f2481867d641bc7482594a30f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classOLTMacCtl.html#ae085e3f2481867d641bc7482594a30f8">OLTMacCtl::transmitState</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a050f1b0fbe6e725bc282b6ad0faf6aa8"></a><!-- doxytag: member="OLTMacCtl::txEnd" ref="a050f1b0fbe6e725bc282b6ad0faf6aa8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classOLTMacCtl.html#a050f1b0fbe6e725bc282b6ad0faf6aa8">OLTMacCtl::txEnd</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="OLTMacCtl_8h.html">OLTMacCtl.h</a></li>
<li><a class="el" href="OLTMacCtl_8cc.html">OLTMacCtl.cc</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Sep 21 16:17:35 2011 for EPONImplementationforOMNet++ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
