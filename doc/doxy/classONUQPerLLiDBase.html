<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>EPONImplementationforOMNet++: ONUQPerLLiDBase Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">EPONImplementationforOMNet++
   &#160;<span id="projectnumber">0.8Beta</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classONUQPerLLiDBase.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">ONUQPerLLiDBase Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="ONUQPerLLiDBase" -->
<p>ONU_Q_mgmt_PerLLiD creates on queue per LLID.  
 <a href="classONUQPerLLiDBase.html#details">More...</a></p>

<p><code>#include &lt;ONUQPerLLiDBase.h&gt;</code></p>
<div class="dynheader">
Inheritance diagram for ONUQPerLLiDBase:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classONUQPerLLiDBase.png" usemap="#ONUQPerLLiDBase_map" alt=""/>
  <map id="ONUQPerLLiDBase_map" name="ONUQPerLLiDBase_map">
<area href="classONU__QPL__RR.html" alt="ONU_QPL_RR" shape="rect" coords="0,56,123,80"/>
</map>
 </div></div>

<p><a href="classONUQPerLLiDBase-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a829a988e869ed9767f248034d91af38c">ONUQPerLLiDBase</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a1b02b905aca6816d2900cdb3babd8b17">~ONUQPerLLiDBase</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#accfc88b3d5775a6853bc98840584e07b">requestPacket</a> ()=0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The queue should send a packet whenever this method is invoked.  <a href="#accfc88b3d5775a6853bc98840584e07b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classMPCPReport.html">MPCPReport</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a8dab2bf2c6295f4c4532a9a6f97675b1">requestMPCP_REPORT</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return an <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> REPORT with the status of the queues.  <a href="#a8dab2bf2c6295f4c4532a9a6f97675b1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#aa868acd8e446143d07120901ed7ea90b">getMPCPRepSize</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> Report Size in Bytes.  <a href="#aa868acd8e446143d07120901ed7ea90b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a2d08a5c7330d012c30ca2d412f2b9f6d">isEmpty</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-types"></a>
Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::vector&lt; <a class="el" href="classQueuePerLLid.html">QueuePerLLid</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#adc4b0bd7a3ec2dace50ad78ef1714217">PonQueues</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector of <a class="el" href="classQueuePerLLid.html" title="Allocation per LLID.">QueuePerLLid</a>'s, vector Because we need them sorted by priority but map will sort by llid (&lt;-unique)  <a href="#adc4b0bd7a3ec2dace50ad78ef1714217"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#ab3d58cf3fc1eeda81f287ec2c682cfc2">initialize</a> (int stage)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a71b4d8e30e4696b1393242daa3323204">numInitStages</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a08e210c1ce75e10b0661b51154306f5a">finish</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#ad443b84024ca761ba999369cea0ddd83">handleMessage</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#ae07abd956695b65ea8a477675db448bf">processFrameFromHigherLayer</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Insert the new message to the proper Q and notify the lower layer.  <a href="#ae07abd956695b65ea8a477675db448bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#af9ce884ee347af25b5473044818fe703">processFrameFromLowerLayer</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a5fbf0e22e4e2dc6f2f3bd62de8bba00a">checkLLIDforUs</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#ae83a8929a005520e6ac00e5a668f303c">getIndexForLLID</a> (uint16_t llid)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Search per LLID and get the index of the queue for this LLID.  <a href="#ae83a8929a005520e6ac00e5a668f303c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a17735ce192fb80b86fe5d0f483be3859">getDefaultLLiD</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the first LLiD flagged as default.  <a href="#a17735ce192fb80b86fe5d0f483be3859"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#ab135adf2f3bdeadfb4a40a9b51476a38">addSortedLLID</a> (<a class="el" href="classQueuePerLLid.html">QueuePerLLid</a> tmp_qpllid)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a new queue to the PonQueues vector in the proper order based on the service priority.  <a href="#ab135adf2f3bdeadfb4a40a9b51476a38"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#abcf4c5ddb613caa15edf375738034c96">checkIfAllEmpty</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check is all the Qs are empty.  <a href="#abcf4c5ddb613caa15edf375738034c96"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a8a33300d16f6541278aff62f769f1380">getIndexForService</a> (std::string name)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Get queue from service name.  <a href="#a8a33300d16f6541278aff62f769f1380"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#adae79b08c78f2507f90365d65030b767">processMPCP</a> (EthernetIIFrame *frame)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a9cef478d7506f19af7f1a948bf6caab4">sendMPCPReg</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#affde37960d1ae9e3f070158113cd2554">startMPCPReg</a> (uint32_t regMaxRandomSleep)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> registration process and sets the regTOMsg (TimeOut for the registration)  <a href="#affde37960d1ae9e3f070158113cd2554"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cModule *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#aa6beb12aead9da4f0f23b51a9cef1494">findModuleUp</a> (const char *name)</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#ac606f2292264d63f9109f19bade56f6f">regTimeOut</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a8cd7c92cd3cd0efd872428f145e2f995">numOfLLIDs</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a799b3ac02ea7e3b7c1f4d513892bbe09">allQsEmpty</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a540b5c0e6f8ba974358e046a5dace738">allQsBlocked</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a8e650a7b93b1bc43e970bae41a2b95cf">nextQIndex</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a17a29180be1ca8f1e68a0b6bfe27e3e1">queueLimit</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#af154b7e6f824a455292ba4e11b5a4651">granularity</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Granularity of QoS limit (i.e. per second &lt;- most common)  <a href="#af154b7e6f824a455292ba4e11b5a4651"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="ServiceConfig_8h.html#aaf9dfd93fb9195bd4743e76b1a1ed879">SrvList</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">serviceList</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classONUQPerLLiDBase.html#adc4b0bd7a3ec2dace50ad78ef1714217">PonQueues</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cModule *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a4b6a938ce21d20c12e0e23e463ca063c">olt_mac</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The OLT MAC module for direct delivery.  <a href="#a4b6a938ce21d20c12e0e23e463ca063c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">MACAddress&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a4e9a1a4a48c094d0fd38302f5a5c6ccd">opt_mac</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The Current ONU Optical MAC Address.  <a href="#a4e9a1a4a48c094d0fd38302f5a5c6ccd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a4dd8b975864c5097f6e76bcecc11dc86">regTOMsg</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classONUQPerLLiDBase.html#a31fb7ad553ee17ddeb2ec4f244374c3f">regSendMsg</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>ONU_Q_mgmt_PerLLiD creates on queue per LLID. </p>
<p>Here is actually done all the bandwidth allocation and timer calculation. Also this class handles the ONU registration and the updates the ONU table. Thus some <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> messages are generated from here and timeouts are defined here. Now since all the time management is done here... we have to define the number of time slots and the time slot duration. Finally this class is aware of any services in this network and thus has a pointer to the SrvList class (if any module is available in the scenario else it is NULL).</p>
<p>The whole idea is to extend this class and create your own bandwidth allocation algorithms. The default behavior of this class is to apply round robin on the queues (per frame). The only thing considered is the priority (not strictly) and happens because the queues are sorted based on the service priority.</p>
<p>Basic methods that would be useful to override when you extend are explained below.</p>
<p>UPDATE: Registration process is now done with sendDirectly to avoid collisions </p>
</div><hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="adc4b0bd7a3ec2dace50ad78ef1714217"></a><!-- doxytag: member="ONUQPerLLiDBase::PonQueues" ref="adc4b0bd7a3ec2dace50ad78ef1714217" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::vector&lt;<a class="el" href="classQueuePerLLid.html">QueuePerLLid</a>&gt; <a class="el" href="classONUQPerLLiDBase.html#adc4b0bd7a3ec2dace50ad78ef1714217">ONUQPerLLiDBase::PonQueues</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Vector of <a class="el" href="classQueuePerLLid.html" title="Allocation per LLID.">QueuePerLLid</a>'s, vector Because we need them sorted by priority but map will sort by llid (&lt;-unique) </p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a829a988e869ed9767f248034d91af38c"></a><!-- doxytag: member="ONUQPerLLiDBase::ONUQPerLLiDBase" ref="a829a988e869ed9767f248034d91af38c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classONUQPerLLiDBase.html#a829a988e869ed9767f248034d91af38c">ONUQPerLLiDBase::ONUQPerLLiDBase</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                {
      <a class="code" href="classONUQPerLLiDBase.html#a4dd8b975864c5097f6e76bcecc11dc86">regTOMsg</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;regTOMsg&quot;</span>, <a class="code" href="ONUQPerLLiDBase_8h.html#adb7345cfb7328fc816da9301acc1e6ff">REGTOMSG</a>);
      <a class="code" href="classONUQPerLLiDBase.html#a31fb7ad553ee17ddeb2ec4f244374c3f">regSendMsg</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;regSendMsg&quot;</span>, <a class="code" href="ONUQPerLLiDBase_8h.html#a04bfc9970f6f324290c19aeefcb640e5">REGSENDMSG</a>);

      <a class="code" href="classONUQPerLLiDBase.html#a540b5c0e6f8ba974358e046a5dace738">allQsBlocked</a>=<span class="keyword">false</span>;
      <a class="code" href="classONUQPerLLiDBase.html#a799b3ac02ea7e3b7c1f4d513892bbe09">allQsEmpty</a>=<span class="keyword">true</span>;
      <a class="code" href="classONUQPerLLiDBase.html#a8e650a7b93b1bc43e970bae41a2b95cf">nextQIndex</a>=0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1b02b905aca6816d2900cdb3babd8b17"></a><!-- doxytag: member="ONUQPerLLiDBase::~ONUQPerLLiDBase" ref="a1b02b905aca6816d2900cdb3babd8b17" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classONUQPerLLiDBase.html#a1b02b905aca6816d2900cdb3babd8b17">ONUQPerLLiDBase::~ONUQPerLLiDBase</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                 {
      cancelAndDelete(<a class="code" href="classONUQPerLLiDBase.html#a31fb7ad553ee17ddeb2ec4f244374c3f">regSendMsg</a>);
      cancelAndDelete(<a class="code" href="classONUQPerLLiDBase.html#a4dd8b975864c5097f6e76bcecc11dc86">regTOMsg</a>);

      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size(); i++){
            <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].clean();
      }
      <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.clear();
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ab135adf2f3bdeadfb4a40a9b51476a38"></a><!-- doxytag: member="ONUQPerLLiDBase::addSortedLLID" ref="ab135adf2f3bdeadfb4a40a9b51476a38" args="(QueuePerLLid tmp_qpllid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classONUQPerLLiDBase.html#ab135adf2f3bdeadfb4a40a9b51476a38">ONUQPerLLiDBase::addSortedLLID</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classQueuePerLLid.html">QueuePerLLid</a>&#160;</td>
          <td class="paramname"><em>tmp_qpllid</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds a new queue to the PonQueues vector in the proper order based on the service priority. </p>
<div class="fragment"><pre class="fragment">                                                          {
      <span class="comment">// Just add it if empty...</span>
      <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.empty()) {
            <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.push_back(tmp_qpllid);
            <span class="keywordflow">return</span>;
      }

      <span class="comment">// Add in the proper possition</span>
      <span class="keywordflow">for</span> (PonQueues::iterator it = <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.begin(); it != <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.end(); it++){
            <span class="keywordflow">if</span> ((*it).prior &lt; tmp_qpllid.prior){
                  <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.insert(it, tmp_qpllid);
                  <span class="keywordflow">return</span>;
            }
      }

      <span class="comment">// If not added till here... add to the end</span>
      <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.push_back(tmp_qpllid);
}
</pre></div>
</div>
</div>
<a class="anchor" id="abcf4c5ddb613caa15edf375738034c96"></a><!-- doxytag: member="ONUQPerLLiDBase::checkIfAllEmpty" ref="abcf4c5ddb613caa15edf375738034c96" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classONUQPerLLiDBase.html#abcf4c5ddb613caa15edf375738034c96">ONUQPerLLiDBase::checkIfAllEmpty</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check is all the Qs are empty. </p>
<p>IF yes set the all empty variable. This must be done after the frame request from the lower layer. </p>
<div class="fragment"><pre class="fragment">                                     {
      <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size() == 0) <a class="code" href="classONUQPerLLiDBase.html#a799b3ac02ea7e3b7c1f4d513892bbe09">allQsEmpty</a> = <span class="keyword">true</span>;
      <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[0].<a class="code" href="classONUQPerLLiDBase.html#a2d08a5c7330d012c30ca2d412f2b9f6d">isEmpty</a>()
                  &amp;&amp; <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size() == 1) <a class="code" href="classONUQPerLLiDBase.html#a799b3ac02ea7e3b7c1f4d513892bbe09">allQsEmpty</a> = <span class="keyword">true</span>;


      <span class="keywordtype">bool</span> found=<span class="keyword">false</span>;
      <span class="comment">// if the current Q is empty -&gt; find the next one</span>
      <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[<a class="code" href="classONUQPerLLiDBase.html#a8e650a7b93b1bc43e970bae41a2b95cf">nextQIndex</a>].<a class="code" href="classONUQPerLLiDBase.html#a2d08a5c7330d012c30ca2d412f2b9f6d">isEmpty</a>()){
            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;(int)<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size(); i++){
                  <span class="keywordflow">if</span> (!<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].<a class="code" href="classONUQPerLLiDBase.html#a2d08a5c7330d012c30ca2d412f2b9f6d">isEmpty</a>()) {
                        found=<span class="keyword">true</span>;
                        <span class="keywordflow">break</span>;
                  }
            }
      <span class="comment">// If not empty.. we have a frame</span>
      }<span class="keywordflow">else</span> found=<span class="keyword">true</span>;

      <a class="code" href="classONUQPerLLiDBase.html#a799b3ac02ea7e3b7c1f4d513892bbe09">allQsEmpty</a> = !found;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5fbf0e22e4e2dc6f2f3bd62de8bba00a"></a><!-- doxytag: member="ONUQPerLLiDBase::checkLLIDforUs" ref="a5fbf0e22e4e2dc6f2f3bd62de8bba00a" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classONUQPerLLiDBase.html#a5fbf0e22e4e2dc6f2f3bd62de8bba00a">ONUQPerLLiDBase::checkLLIDforUs</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                 {
      <span class="comment">// Drop if it is not for us based on LLID</span>
      <a class="code" href="classEPON__LLidCtrlInfo.html" title="EPON_LLidCtrlInfo extends cObject and is used for ControlInfo carried in the messages.">EPON_LLidCtrlInfo</a> * nfo =  <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classEPON__LLidCtrlInfo.html" title="EPON_LLidCtrlInfo extends cObject and is used for ControlInfo carried in the messages.">EPON_LLidCtrlInfo</a> *<span class="keyword">&gt;</span>(msg-&gt;getControlInfo());
      <span class="comment">// Check for BC</span>
      <span class="keywordflow">if</span> (nfo &amp;&amp; nfo-&gt;<a class="code" href="classEPON__LLidCtrlInfo.html#a22816820608cef4293a7c296d3de8734">llid</a> != <a class="code" href="EPON__CtrlInfo_8h.html#a9c30e6b907d649b65497274b020a3537">LLID_EPON_BC</a>){
            <span class="comment">// -1 = No such llid</span>
            <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#ae83a8929a005520e6ac00e5a668f303c" title="Search per LLID and get the index of the queue for this LLID.">getIndexForLLID</a>(nfo-&gt;<a class="code" href="classEPON__LLidCtrlInfo.html#a22816820608cef4293a7c296d3de8734">llid</a>) == -1) {
                  <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
      }
      <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa6beb12aead9da4f0f23b51a9cef1494"></a><!-- doxytag: member="ONUQPerLLiDBase::findModuleUp" ref="aa6beb12aead9da4f0f23b51a9cef1494" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cModule * <a class="el" href="classONUQPerLLiDBase.html#aa6beb12aead9da4f0f23b51a9cef1494">ONUQPerLLiDBase::findModuleUp</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                        {
      cModule *mod = NULL;
      <span class="keywordflow">for</span> (cModule *curmod=<span class="keyword">this</span>; !mod &amp;&amp; curmod; curmod=curmod-&gt;getParentModule())
           mod = curmod-&gt;getSubmodule(name);
      <span class="keywordflow">return</span> mod;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a08e210c1ce75e10b0661b51154306f5a"></a><!-- doxytag: member="ONUQPerLLiDBase::finish" ref="a08e210c1ce75e10b0661b51154306f5a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classONUQPerLLiDBase.html#a08e210c1ce75e10b0661b51154306f5a">ONUQPerLLiDBase::finish</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                            {
      simtime_t t = simTime();

      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size(); i++){
            std::string srvName=<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].getServiceName();
            std::string name=srvName+<span class="stringliteral">&quot; BytesDropped&quot;</span>;
            recordScalar(name.c_str(), <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].vec-&gt;numBytesDropped  );
            name=srvName+<span class="stringliteral">&quot; BytesSent&quot;</span>;
            recordScalar(name.c_str(), <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].vec-&gt;numBytesSent  );

            <span class="keywordflow">if</span> (t&gt;0)
            {
                  name=srvName+<span class="stringliteral">&quot; bytes dropped/sec&quot;</span>;
                  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> dropped = <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].vec-&gt;numBytesDropped;
                  recordScalar(name.c_str(), dropped/t);
                  name=srvName+<span class="stringliteral">&quot; bytes sent/sec&quot;</span>;
                  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sent = <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].vec-&gt;numBytesSent;
                  recordScalar(name.c_str(), sent/t);
                  name=srvName+<span class="stringliteral">&quot; Drop PerCent&quot;</span>;
                  <span class="keywordflow">if</span> (dropped+sent  == 0)
                        recordScalar(name.c_str(), 0.0);
                  <span class="keywordflow">else</span>
                        recordScalar(name.c_str(), (double)100*((<span class="keywordtype">double</span>)dropped/(dropped+sent)));
            }
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a17735ce192fb80b86fe5d0f483be3859"></a><!-- doxytag: member="ONUQPerLLiDBase::getDefaultLLiD" ref="a17735ce192fb80b86fe5d0f483be3859" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classONUQPerLLiDBase.html#a17735ce192fb80b86fe5d0f483be3859">ONUQPerLLiDBase::getDefaultLLiD</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the first LLiD flagged as default. </p>
<div class="fragment"><pre class="fragment">                                   {
      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size(); i++)
            <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].isDefault) <span class="keywordflow">return</span> <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].llid;

      <span class="keywordflow">return</span> <a class="code" href="EPON__CtrlInfo_8h.html#a9c30e6b907d649b65497274b020a3537">LLID_EPON_BC</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae83a8929a005520e6ac00e5a668f303c"></a><!-- doxytag: member="ONUQPerLLiDBase::getIndexForLLID" ref="ae83a8929a005520e6ac00e5a668f303c" args="(uint16_t llid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classONUQPerLLiDBase.html#ae83a8929a005520e6ac00e5a668f303c">ONUQPerLLiDBase::getIndexForLLID</a> </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>llid</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Search per LLID and get the index of the queue for this LLID. </p>
<p>Useful for en-queuing frames from the higher layers. </p>
<div class="fragment"><pre class="fragment">                                                 {
      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size(); i++)
            <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].llid == llid) <span class="keywordflow">return</span> i;

      <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8a33300d16f6541278aff62f769f1380"></a><!-- doxytag: member="ONUQPerLLiDBase::getIndexForService" ref="a8a33300d16f6541278aff62f769f1380" args="(std::string name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classONUQPerLLiDBase.html#a8a33300d16f6541278aff62f769f1380">ONUQPerLLiDBase::getIndexForService</a> </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get queue from service name. </p>
<div class="fragment"><pre class="fragment">                                                     {
      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size(); i++)
                  <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].getServiceName() == name)
                        <span class="keywordflow">return</span> i;

      <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa868acd8e446143d07120901ed7ea90b"></a><!-- doxytag: member="ONUQPerLLiDBase::getMPCPRepSize" ref="aa868acd8e446143d07120901ed7ea90b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t <a class="el" href="classONUQPerLLiDBase.html#aa868acd8e446143d07120901ed7ea90b">ONUQPerLLiDBase::getMPCPRepSize</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> Report Size in Bytes. </p>
<div class="fragment"><pre class="fragment">                                        {
      <span class="keywordflow">return</span> <a class="code" href="MPCP__codes_8h.html#a53a5bdadb1af2c43add7d5e29f2b6d11">MPCP_HEADER_LEN</a>+1+<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size()*2;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad443b84024ca761ba999369cea0ddd83"></a><!-- doxytag: member="ONUQPerLLiDBase::handleMessage" ref="ad443b84024ca761ba999369cea0ddd83" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classONUQPerLLiDBase.html#ad443b84024ca761ba999369cea0ddd83">ONUQPerLLiDBase::handleMessage</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{

      <span class="comment">// Self Message</span>
      <span class="keywordflow">if</span> (msg-&gt;isSelfMessage())
      {
            EV &lt;&lt; <span class="stringliteral">&quot;Self-message &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; received\n&quot;</span>;

            <span class="keywordflow">if</span> (msg == <a class="code" href="classONUQPerLLiDBase.html#a4dd8b975864c5097f6e76bcecc11dc86">regTOMsg</a>){
                  EV &lt;&lt; <span class="stringliteral">&quot;*** ONUMacCtl: Registration FAILED&quot;</span>&lt;&lt;endl;
            }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classONUQPerLLiDBase.html#a31fb7ad553ee17ddeb2ec4f244374c3f">regSendMsg</a>)
                  <a class="code" href="classONUQPerLLiDBase.html#a9cef478d7506f19af7f1a948bf6caab4">sendMPCPReg</a>();
            <span class="keywordflow">else</span>
                  error(<span class="stringliteral">&quot;Unknown self message received!&quot;</span>);

            <span class="keywordflow">return</span>;
      }


      <span class="comment">// Network Message</span>
      cGate *ingate = msg-&gt;getArrivalGate();
      EV &lt;&lt; <span class="stringliteral">&quot;Frame &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; arrived on port &quot;</span> &lt;&lt; ingate-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;...\n&quot;</span>;

      <span class="keywordflow">if</span> (ingate-&gt;getId() ==  gate( <span class="stringliteral">&quot;lowerLayerIn&quot;</span>)-&gt;getId()){
            <a class="code" href="classONUQPerLLiDBase.html#af9ce884ee347af25b5473044818fe703">processFrameFromLowerLayer</a>(msg);
      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ingate-&gt;getId() ==  gate( <span class="stringliteral">&quot;upperLayerIn&quot;</span>)-&gt;getId()){
            <span class="comment">// Add the frame to the proper Q</span>
            <a class="code" href="classONUQPerLLiDBase.html#ae07abd956695b65ea8a477675db448bf" title="Insert the new message to the proper Q and notify the lower layer.">processFrameFromHigherLayer</a>(msg);
      }<span class="keywordflow">else</span>{
            EV &lt;&lt; <span class="stringliteral">&quot;ONUMacCtl: Message came FROM THE WRONG DIRRECTION???? Dropping\n&quot;</span>;
            <span class="keyword">delete</span> msg;
      }

}
</pre></div>
</div>
</div>
<a class="anchor" id="ab3d58cf3fc1eeda81f287ec2c682cfc2"></a><!-- doxytag: member="ONUQPerLLiDBase::initialize" ref="ab3d58cf3fc1eeda81f287ec2c682cfc2" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classONUQPerLLiDBase.html#ab3d58cf3fc1eeda81f287ec2c682cfc2">ONUQPerLLiDBase::initialize</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="classONU__QPL__RR.html#a9afa7b83cd80b6ea5e240bfe072c737b">ONU_QPL_RR</a>.</p>
<div class="fragment"><pre class="fragment">{
      <span class="keywordflow">if</span> (stage == 0){
            <a class="code" href="classONUQPerLLiDBase.html#a8cd7c92cd3cd0efd872428f145e2f995">numOfLLIDs</a>=1;
            <a class="code" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">serviceList</a>=NULL;

            <span class="keywordflow">if</span> (dynamic_cast&lt;ServiceConfig *&gt;( <a class="code" href="classONUQPerLLiDBase.html#aa6beb12aead9da4f0f23b51a9cef1494">findModuleUp</a>(<span class="stringliteral">&quot;serviceConfig&quot;</span>)) != NULL){
                  <a class="code" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">serviceList</a> = &amp;(<span class="keyword">dynamic_cast&lt;</span><a class="code" href="classServiceConfig.html" title="A simple module to configure all the services in a scenario and their parameters.">ServiceConfig</a> *<span class="keyword">&gt;</span>( <a class="code" href="classONUQPerLLiDBase.html#aa6beb12aead9da4f0f23b51a9cef1494">findModuleUp</a>(<span class="stringliteral">&quot;serviceConfig&quot;</span>))-&gt;srvs);
                  <span class="comment">// 1 llid per service</span>
                  <a class="code" href="classONUQPerLLiDBase.html#a8cd7c92cd3cd0efd872428f145e2f995">numOfLLIDs</a> = <a class="code" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">serviceList</a>-&gt;size();
            }
            <span class="comment">// Parameters</span>
            <a class="code" href="classONUQPerLLiDBase.html#ac606f2292264d63f9109f19bade56f6f">regTimeOut</a> = par(<span class="stringliteral">&quot;regTimeOut&quot;</span>);
            <a class="code" href="classONUQPerLLiDBase.html#ac606f2292264d63f9109f19bade56f6f">regTimeOut</a>/=1000;
            <a class="code" href="classONUQPerLLiDBase.html#a17a29180be1ca8f1e68a0b6bfe27e3e1">queueLimit</a> = par(<span class="stringliteral">&quot;queueLimit&quot;</span>);



            <span class="comment">// Parameters</span>
            <a class="code" href="classONUQPerLLiDBase.html#af154b7e6f824a455292ba4e11b5a4651" title="Granularity of QoS limit (i.e. per second &lt;- most common)">granularity</a> = par(<span class="stringliteral">&quot;statsGranularity&quot;</span>).doubleValue();


            <span class="comment">// Create Q for BroadCasts</span>
            <a class="code" href="classQueuePerLLid.html" title="Allocation per LLID.">QueuePerLLid</a> tmp_qpllid;
            tmp_qpllid.setServiceName(<span class="stringliteral">&quot;BroadCast&quot;</span>);
            tmp_qpllid.prior = 0.0;
            tmp_qpllid.<a class="code" href="classQueuePerLLid.html#a0c620a9cb52c96647acbf6c4a154ee0d">llid</a> = <a class="code" href="EPON__CtrlInfo_8h.html#a9c30e6b907d649b65497274b020a3537">LLID_EPON_BC</a>;
            tmp_qpllid.vec-&gt;setGranularity(<a class="code" href="classONUQPerLLiDBase.html#af154b7e6f824a455292ba4e11b5a4651" title="Granularity of QoS limit (i.e. per second &lt;- most common)">granularity</a>);
            tmp_qpllid.queueLimit = <a class="code" href="classONUQPerLLiDBase.html#a17a29180be1ca8f1e68a0b6bfe27e3e1">queueLimit</a>;
            <a class="code" href="classONUQPerLLiDBase.html#ab135adf2f3bdeadfb4a40a9b51476a38" title="Adds a new queue to the PonQueues vector in the proper order based on the service priority...">addSortedLLID</a>(tmp_qpllid);

            WATCH_VECTOR(<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>);


            <span class="comment">// Get olt module</span>
            <a class="code" href="classONUQPerLLiDBase.html#a4b6a938ce21d20c12e0e23e463ca063c" title="The OLT MAC module for direct delivery.">olt_mac</a> = simulation.getModuleByPath(<span class="stringliteral">&quot;epon_olt.olt_if.epon_mac&quot;</span>);
            <span class="keywordflow">if</span> (!<a class="code" href="classONUQPerLLiDBase.html#a4b6a938ce21d20c12e0e23e463ca063c" title="The OLT MAC module for direct delivery.">olt_mac</a>)
                  opp_error(<span class="stringliteral">&quot;Cannot get EPON MAC module for registration!&quot;</span>);
      }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (stage == 1){
            EtherMACBase *mac = <span class="keyword">dynamic_cast&lt;</span>EtherMACBase *<span class="keyword">&gt;</span>
                  (gate(<span class="stringliteral">&quot;lowerLayerOut&quot;</span>)-&gt;getNextGate()-&gt;getOwnerModule()-&gt;gate(<span class="stringliteral">&quot;lowerLayerOut&quot;</span>)-&gt;getNextGate()-&gt;getOwnerModule());
            <a class="code" href="classONUQPerLLiDBase.html#a4e9a1a4a48c094d0fd38302f5a5c6ccd" title="The Current ONU Optical MAC Address.">opt_mac</a> = mac-&gt;getMACAddress();
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2d08a5c7330d012c30ca2d412f2b9f6d"></a><!-- doxytag: member="ONUQPerLLiDBase::isEmpty" ref="a2d08a5c7330d012c30ca2d412f2b9f6d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classONUQPerLLiDBase.html#a2d08a5c7330d012c30ca2d412f2b9f6d">ONUQPerLLiDBase::isEmpty</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                             {
      <a class="code" href="classONUQPerLLiDBase.html#abcf4c5ddb613caa15edf375738034c96" title="Check is all the Qs are empty.">checkIfAllEmpty</a>();
      <span class="keywordflow">return</span> <a class="code" href="classONUQPerLLiDBase.html#a799b3ac02ea7e3b7c1f4d513892bbe09">allQsEmpty</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a71b4d8e30e4696b1393242daa3323204"></a><!-- doxytag: member="ONUQPerLLiDBase::numInitStages" ref="a71b4d8e30e4696b1393242daa3323204" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual int <a class="el" href="classONUQPerLLiDBase.html#a71b4d8e30e4696b1393242daa3323204">ONUQPerLLiDBase::numInitStages</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> 2;}
</pre></div>
</div>
</div>
<a class="anchor" id="ae07abd956695b65ea8a477675db448bf"></a><!-- doxytag: member="ONUQPerLLiDBase::processFrameFromHigherLayer" ref="ae07abd956695b65ea8a477675db448bf" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classONUQPerLLiDBase.html#ae07abd956695b65ea8a477675db448bf">ONUQPerLLiDBase::processFrameFromHigherLayer</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Insert the new message to the proper Q and notify the lower layer. </p>
<p>Notification is needed only in the case that all the queues are empty. This is because MAC layer will probably be in IDLE status and the start Tx period is not scheduled. By notifying the MAC layer we send a WakeUp msg and it will schedule the next Tx period. </p>
<div class="fragment"><pre class="fragment">                                                              {
      EV &lt;&lt; <span class="stringliteral">&quot;ONUQPerLLiDBase: Incoming from higher layer...\n&quot;</span>;


      <a class="code" href="classEPON__LLidCtrlInfo.html" title="EPON_LLidCtrlInfo extends cObject and is used for ControlInfo carried in the messages.">EPON_LLidCtrlInfo</a> *nfo = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classEPON__LLidCtrlInfo.html" title="EPON_LLidCtrlInfo extends cObject and is used for ControlInfo carried in the messages.">EPON_LLidCtrlInfo</a> *<span class="keyword">&gt;</span>(msg-&gt;getControlInfo());

      <span class="comment">// If frame has no info or is BC add to the BroadCast Q</span>
      <span class="keywordtype">int</span> Q_index=-1;
      <span class="keywordflow">if</span> (!nfo){
            Q_index = <a class="code" href="classONUQPerLLiDBase.html#ae83a8929a005520e6ac00e5a668f303c" title="Search per LLID and get the index of the queue for this LLID.">getIndexForLLID</a>(<a class="code" href="classONUQPerLLiDBase.html#a17735ce192fb80b86fe5d0f483be3859" title="Return the first LLiD flagged as default.">getDefaultLLiD</a>());
      }<span class="keywordflow">else</span>{
            Q_index = <a class="code" href="classONUQPerLLiDBase.html#ae83a8929a005520e6ac00e5a668f303c" title="Search per LLID and get the index of the queue for this LLID.">getIndexForLLID</a>(nfo-&gt;<a class="code" href="classEPON__LLidCtrlInfo.html#a22816820608cef4293a7c296d3de8734">llid</a>);
      }

      <span class="comment">// Check if we can forward frame</span>
      <span class="keywordflow">if</span> (Q_index == -1){
            EV &lt;&lt; <span class="stringliteral">&quot;*** WRONG LLID : DROPPING&quot;</span> &lt;&lt;endl;
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
      }

      <span class="comment">// Update the incoming rate BEFORE discarding message</span>
      <span class="comment">// in case the Q is full.</span>
      cPacket *pkt = <span class="keyword">dynamic_cast&lt;</span>cPacket *<span class="keyword">&gt;</span>(msg);
      <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[Q_index].vec-&gt;numIncomingBits+=pkt-&gt;getBitLength();

      <span class="comment">// IF all empty send... WAKE UP AND ENQUEUE</span>
      <span class="comment">// if you send the message directly, it will still work</span>
      <span class="comment">// But subclasses do not get the chance to inspect Q polices</span>
      <span class="comment">// like data rate limit!</span>
      <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#a799b3ac02ea7e3b7c1f4d513892bbe09">allQsEmpty</a> || <a class="code" href="classONUQPerLLiDBase.html#a540b5c0e6f8ba974358e046a5dace738">allQsBlocked</a>){
            <a class="code" href="classONUQPerLLiDBase.html#a799b3ac02ea7e3b7c1f4d513892bbe09">allQsEmpty</a> = <span class="keyword">false</span>;
            <a class="code" href="classONUQPerLLiDBase.html#a540b5c0e6f8ba974358e046a5dace738">allQsBlocked</a> = <span class="keyword">false</span>;

            EV &lt;&lt; <span class="stringliteral">&quot;Sending WAKE UP message to MAC&quot;</span>&lt;&lt;endl;
            send(<span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;WAKE UP&quot;</span>, <a class="code" href="OLTMacCtl__NP_8h.html#a3593b1b91fec6813d3d03abfee96f8e7">WAKEUPMSG</a>), <span class="stringliteral">&quot;lowerLayerOut&quot;</span>);
      }

      <span class="comment">// Check that Q is not full</span>
      <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[Q_index].length() &gt;= <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[Q_index].<a class="code" href="classONUQPerLLiDBase.html#a17a29180be1ca8f1e68a0b6bfe27e3e1">queueLimit</a>){
            <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[Q_index].vec-&gt;numBytesDropped+=pkt-&gt;getByteLength();
            <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[Q_index].vec-&gt;recordVectors();
            EV &lt;&lt; <span class="stringliteral">&quot;Dropping&quot;</span>&lt;&lt;endl;
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
      }<span class="keywordflow">else</span>{
            <span class="comment">// Record the incoming bytes</span>
            EV &lt;&lt; <span class="stringliteral">&quot;Enqueue&quot;</span>&lt;&lt;endl;
            <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[Q_index].vec-&gt;recordVectors();
      }


      <span class="comment">// Finally add to the Q</span>
      <a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[Q_index].insert(dynamic_cast&lt;cPacket *&gt;(msg));




}
</pre></div>
</div>
</div>
<a class="anchor" id="af9ce884ee347af25b5473044818fe703"></a><!-- doxytag: member="ONUQPerLLiDBase::processFrameFromLowerLayer" ref="af9ce884ee347af25b5473044818fe703" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classONUQPerLLiDBase.html#af9ce884ee347af25b5473044818fe703">ONUQPerLLiDBase::processFrameFromLowerLayer</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                             {
      EV &lt;&lt; <span class="stringliteral">&quot;ONUQPerLLiDBase: Incoming from lower layer...\n&quot;</span>;

      EthernetIIFrame * frame = <span class="keyword">dynamic_cast&lt;</span>EthernetIIFrame *<span class="keyword">&gt;</span>(msg);


      <span class="keywordflow">if</span> (frame &amp;&amp; frame-&gt;getEtherType() == <a class="code" href="MPCP__codes_8h.html#a01d93522186165aff8e9d9907b04aec3">MPCP_TYPE</a>){
            <a class="code" href="classONUQPerLLiDBase.html#adae79b08c78f2507f90365d65030b767">processMPCP</a>(frame );
            <span class="keywordflow">return</span>;
      }

      <span class="comment">// Drop if it is not for us based on LLID</span>
      <span class="keywordflow">if</span> (!<a class="code" href="classONUQPerLLiDBase.html#a5fbf0e22e4e2dc6f2f3bd62de8bba00a">checkLLIDforUs</a>(msg)) {
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
      }

      send(msg,<span class="stringliteral">&quot;upperLayerOut&quot;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="adae79b08c78f2507f90365d65030b767"></a><!-- doxytag: member="ONUQPerLLiDBase::processMPCP" ref="adae79b08c78f2507f90365d65030b767" args="(EthernetIIFrame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classONUQPerLLiDBase.html#adae79b08c78f2507f90365d65030b767">ONUQPerLLiDBase::processMPCP</a> </td>
          <td>(</td>
          <td class="paramtype">EthernetIIFrame *&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>+1 Cause the last one is going to be the BE or Default queue...</p>
<div class="fragment"><pre class="fragment">                                                        {
      EV &lt;&lt; <span class="stringliteral">&quot;ONUMacCtl: MPCP Frame processing\n&quot;</span>;
      <a class="code" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> * mpcp = check_and_cast&lt;<a class="code" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> *&gt;(frame);


      <span class="keywordflow">switch</span> (mpcp-&gt;<a class="code" href="classMPCP.html#a68374d0a62fbdd1c40f264f1a9a9230b">getOpcode</a>())
      {
            <span class="keywordflow">case</span> <a class="code" href="MPCP__codes_8h.html#ab52e72f4e759864e6bc6792412caa7f5">MPCP_REGISTER</a>:
            {

                  <a class="code" href="classMPCPRegAck.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPRegAck</a> *ack = <span class="keyword">new</span> <a class="code" href="classMPCPRegAck.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPRegAck</a>();
                  <a class="code" href="classMPCPRegister.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPRegister</a> * reg = check_and_cast&lt;<a class="code" href="classMPCPRegister.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPRegister</a> *&gt;(frame);

                  EV &lt;&lt; <span class="stringliteral">&quot;ONUMacCtl: Type is MPCP_REGISTER\n&quot;</span>;
                  cancelEvent(<a class="code" href="classONUQPerLLiDBase.html#a4dd8b975864c5097f6e76bcecc11dc86">regTOMsg</a>);
                  EV &lt;&lt; <span class="stringliteral">&quot;ONUMacCtl: Canceling RegTOMsg\n&quot;</span>;

                  ack-&gt;<a class="code" href="classMPCP.html#ac16411714bb8f9b3f4bc9e4fc88ae17f">setOpcode</a>(<a class="code" href="MPCP__codes_8h.html#a5c088b9851d17a5099e83549071388cd">MPCP_REGACK</a>);
                  ack-&gt;setName(<span class="stringliteral">&quot;MPCPAck&quot;</span>);
                  ack-&gt;setEtherType(<a class="code" href="MPCP__codes_8h.html#a01d93522186165aff8e9d9907b04aec3">MPCP_TYPE</a>);
                  ack-&gt;setDest(mpcp-&gt;getSrc());
                  ack-&gt;setByteLength(<a class="code" href="MPCP__codes_8h.html#a53a5bdadb1af2c43add7d5e29f2b6d11">MPCP_HEADER_LEN</a>);

                  <span class="keywordtype">int</span> LLID_num=reg-&gt;<a class="code" href="classMPCPRegister.html#a65abe8520add5c97a8fb0d5b59af3006">getPtpNumReg</a>();

                  EV&lt;&lt; <span class="stringliteral">&quot;Assigned LLIDs:&quot;</span> &lt;&lt;LLID_num&lt;&lt;endl;
                  <span class="keywordflow">for</span> (uint8_t i=0; i&lt;reg-&gt;<a class="code" href="classMPCPRegister.html#a0ea03ed1bbd76d6ad76fae492b5712ee">getLLIDsArraySize</a>(); i++){
                        <span class="comment">// 0xFFF = 4095 intrand -&gt; [0-4095)</span>
                        EV&lt;&lt; (int)i&lt;&lt;<span class="stringliteral">&quot;  &quot;</span> &lt;&lt;(<span class="keywordtype">int</span>)reg-&gt;getLLIDs(i)&lt;&lt;endl;
                        <a class="code" href="classQueuePerLLid.html" title="Allocation per LLID.">QueuePerLLid</a> tmp_qpllid;
                        tmp_qpllid.llid = reg-&gt;getLLIDs(i);
                        std::<span class="keywordtype">string</span> tmp_name=&quot;Default&quot;;
                        tmp_qpllid.prior = 0.0;
                        if (<a class="code" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">serviceList</a> &amp;&amp; <a class="code" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">serviceList</a>-&gt;size() &gt; i) {
                              tmp_name=<a class="code" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">serviceList</a>-&gt;at(i).name;
                              EV&lt;&lt;tmp_name&lt;&lt;<span class="stringliteral">&quot; -- &quot;</span>&lt;&lt;reg-&gt;<a class="code" href="classMPCPRegister.html#af0121bd6e8823754e944615d64c25298">getLLIDs</a>(i)&lt;&lt;endl;
                              tmp_qpllid.prior = <a class="code" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">serviceList</a>-&gt;at(i).priority;
                              tmp_qpllid.<a class="code" href="classQueuePerLLid.html#a0a1f37f86b9ee73cde90431324ea597f">isDefault</a> = <span class="keyword">false</span>;
                        }

                        <span class="comment">// Use the last LLiD as the default</span>
                        <span class="keywordflow">if</span> ( reg-&gt;<a class="code" href="classMPCPRegister.html#a0ea03ed1bbd76d6ad76fae492b5712ee">getLLIDsArraySize</a>() -1 == i){
                              EV &lt;&lt; <span class="stringliteral">&quot;Setting the default LLiD (BE) to &quot;</span>&lt;&lt;tmp_qpllid.<a class="code" href="classQueuePerLLid.html#a0c620a9cb52c96647acbf6c4a154ee0d">llid</a>&lt;&lt;endl;
                              tmp_name=<span class="stringliteral">&quot;Default&quot;</span>;
                              tmp_qpllid.prior = 0.0001;
                              tmp_qpllid.<a class="code" href="classQueuePerLLid.html#a0a1f37f86b9ee73cde90431324ea597f">isDefault</a> = <span class="keyword">true</span>;
                        }

                        tmp_qpllid.setServiceName(tmp_name);
                        tmp_qpllid.queueLimit = <a class="code" href="classONUQPerLLiDBase.html#a17a29180be1ca8f1e68a0b6bfe27e3e1">queueLimit</a>;
                        tmp_qpllid.vec-&gt;setGranularity(<a class="code" href="classONUQPerLLiDBase.html#af154b7e6f824a455292ba4e11b5a4651" title="Granularity of QoS limit (i.e. per second &lt;- most common)">granularity</a>);
                        <a class="code" href="classONUQPerLLiDBase.html#ab135adf2f3bdeadfb4a40a9b51476a38" title="Adds a new queue to the PonQueues vector in the proper order based on the service priority...">addSortedLLID</a>(tmp_qpllid);

                  }

                  <span class="comment">//send(ack,&quot;lowerLayerOut&quot;);</span>
                  <span class="comment">// Urb@n: Send directly on upstream to avoid collisions</span>
                  ack-&gt;addByteLength(PREAMBLE_BYTES);
                  ack-&gt;setSrc(<a class="code" href="classONUQPerLLiDBase.html#a4e9a1a4a48c094d0fd38302f5a5c6ccd" title="The Current ONU Optical MAC Address.">opt_mac</a>);
                  sendDirect(ack, <a class="code" href="classONUQPerLLiDBase.html#a4b6a938ce21d20c12e0e23e463ca063c" title="The OLT MAC module for direct delivery.">olt_mac</a>, <a class="code" href="classONUQPerLLiDBase.html#a4b6a938ce21d20c12e0e23e463ca063c" title="The OLT MAC module for direct delivery.">olt_mac</a>-&gt;gate(<span class="stringliteral">&quot;direct&quot;</span>)-&gt;getId());

                  <span class="comment">// Send the frame on top layer that manages LLIDs</span>
                  send(frame-&gt;dup(),<span class="stringliteral">&quot;upperLayerOut&quot;</span>);

                  <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="MPCP__codes_8h.html#a190716814784e1e13cfd09ef6e773f5d">MPCP_GATE</a>:
            {
                  <a class="code" href="classMPCPGate.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPGate</a> * gate = check_and_cast&lt;<a class="code" href="classMPCPGate.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPGate</a> *&gt;(frame);
                  EV &lt;&lt; <span class="stringliteral">&quot;ONUQPerLLiDBase: Type is MPCP_GATE\n&quot;</span>;


                  <span class="comment">// Register Grant</span>
                  <span class="keywordflow">if</span> (gate-&gt;<a class="code" href="classMPCPGate.html#aa568e79e9c26b388d9e291ccd76db8c5">getListLen</a>() == 1
                        &amp;&amp; gate-&gt;getDest().isBroadcast())
                  {
                        EV &lt;&lt; <span class="stringliteral">&quot;ONUMacCtl: MPCP REGISTER GRANT (DOOUUU)&quot;</span> &lt;&lt;endl;
                        <span class="comment">// Process here number of llids...</span>
<span class="comment"></span>                        <span class="keywordflow">if</span> (<a class="code" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">serviceList</a>) <a class="code" href="classONUQPerLLiDBase.html#a8cd7c92cd3cd0efd872428f145e2f995">numOfLLIDs</a> = <a class="code" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">serviceList</a>-&gt;size()+1;
                        <a class="code" href="classONUQPerLLiDBase.html#affde37960d1ae9e3f070158113cd2554" title="Initializes the MPCP registration process and sets the regTOMsg (TimeOut for the registration)">startMPCPReg</a>(gate-&gt;<a class="code" href="classMPCPGate.html#a3b82c4a4e1246e2170e49451690d9efe">getDuration</a>(0));
                        <span class="keywordflow">break</span>;
                  }

                  <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">default</span>:
                  EV &lt;&lt; <span class="stringliteral">&quot;ONUMacCtl: Unrecognized MPCP OpCode!!\n&quot;</span>;
                  <span class="keywordflow">return</span>;
      };

      <span class="keyword">delete</span> frame;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8dab2bf2c6295f4c4532a9a6f97675b1"></a><!-- doxytag: member="ONUQPerLLiDBase::requestMPCP_REPORT" ref="a8dab2bf2c6295f4c4532a9a6f97675b1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMPCPReport.html">MPCPReport</a> * <a class="el" href="classONUQPerLLiDBase.html#a8dab2bf2c6295f4c4532a9a6f97675b1">ONUQPerLLiDBase::requestMPCP_REPORT</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return an <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> REPORT with the status of the queues. </p>
<div class="fragment"><pre class="fragment">                                                {
      <a class="code" href="classMPCPReport.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPReport</a> * rep = <span class="keyword">new</span> <a class="code" href="classMPCPReport.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPReport</a>();
      rep-&gt;<a class="code" href="classMPCP.html#ac16411714bb8f9b3f4bc9e4fc88ae17f">setOpcode</a>(<a class="code" href="MPCP__codes_8h.html#ac549493bf4e9303c1e0e090133f065ec">MPCP_REPORT</a>);
      rep-&gt;setEtherType(<a class="code" href="MPCP__codes_8h.html#a01d93522186165aff8e9d9907b04aec3">MPCP_TYPE</a>);
      <span class="comment">// TODO: replace with OLT mac... at some point</span>
      rep-&gt;setDest(MACAddress(<span class="stringliteral">&quot;FF:FF:FF:FF:FF:FF&quot;</span>));
      rep-&gt;setSrc(<a class="code" href="classONUQPerLLiDBase.html#a4e9a1a4a48c094d0fd38302f5a5c6ccd" title="The Current ONU Optical MAC Address.">opt_mac</a>);

      rep-&gt;<a class="code" href="classMPCPReport.html#a2265d793690c2c8aec6fc4d1ead4d04b">setQInfoArraySize</a>(<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size());

      uint8_t bitFlag=0;
      <span class="comment">// For Each Queue</span>
      <span class="keywordflow">for</span> (uint i=0; i&lt;<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>.size(); i++){
            <span class="comment">// Enable the proper bit</span>
            bitFlag|=(0x01&lt;&lt;(7-i));
            EV&lt;&lt;<span class="stringliteral">&quot;BF: &quot;</span>&lt;&lt;bitFlag&lt;&lt;endl;

            <span class="comment">// Convert bits in the queue to ns16 request</span>
            <span class="comment">// TODO: hardcoded line rate 1Gpbs</span>
            uint32_t tmpreq=<a class="code" href="classMPCPTools.html#aad3dded8a89fb9b2737eefdb40408bc2" title="Convert bits to ns16.">MPCPTools::bitsToNS16</a>(<a class="code" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">pon_queues</a>[i].getBitLength(), 1);

            <span class="comment">// Set the requested bandwidth...</span>
            rep-&gt;<a class="code" href="classMPCPReport.html#afed76befee3f5353cb4d10b974aea14f">setQInfo</a>(i, tmpreq);
      }

      <span class="comment">// Set the Map</span>
      rep-&gt;<a class="code" href="classMPCPReport.html#ab51ac508d7921441ffc63686129181e1">setBitMap</a>(bitFlag);

      <span class="comment">// Header + bitMap + #*uint16 (uint32 is used to avoid overflows...)</span>
      rep-&gt;setByteLength(<a class="code" href="classONUQPerLLiDBase.html#aa868acd8e446143d07120901ed7ea90b" title="Return the MPCP Report Size in Bytes.">getMPCPRepSize</a>());

      <span class="comment">// TODO: the std say that it should be mapped to an LLID</span>
      <span class="comment">// use EtherFrameWithLLID...</span>
      <span class="keywordflow">return</span> rep;
}
</pre></div>
</div>
</div>
<a class="anchor" id="accfc88b3d5775a6853bc98840584e07b"></a><!-- doxytag: member="ONUQPerLLiDBase::requestPacket" ref="accfc88b3d5775a6853bc98840584e07b" args="()=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="classONUQPerLLiDBase.html#accfc88b3d5775a6853bc98840584e07b">ONUQPerLLiDBase::requestPacket</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The queue should send a packet whenever this method is invoked. </p>
<p>If the queue is currently empty, it should send a packet when when one becomes available. </p>

<p>Implemented in <a class="el" href="classONU__QPL__RR.html#ad1b9452107ffa215a7ba8e90944c2263">ONU_QPL_RR</a>.</p>

</div>
</div>
<a class="anchor" id="a9cef478d7506f19af7f1a948bf6caab4"></a><!-- doxytag: member="ONUQPerLLiDBase::sendMPCPReg" ref="a9cef478d7506f19af7f1a948bf6caab4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classONUQPerLLiDBase.html#a9cef478d7506f19af7f1a948bf6caab4">ONUQPerLLiDBase::sendMPCPReg</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                 {



      <a class="code" href="classMPCPRegReq.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPRegReq</a> *regreq = <span class="keyword">new</span> <a class="code" href="classMPCPRegReq.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPRegReq</a>();
      regreq-&gt;setDest(MACAddress(<span class="stringliteral">&quot;FF:FF:FF:FF:FF:FF&quot;</span>));
      regreq-&gt;setEtherType(<a class="code" href="MPCP__codes_8h.html#a01d93522186165aff8e9d9907b04aec3">MPCP_TYPE</a>);
      regreq-&gt;setName(<span class="stringliteral">&quot;MPCPRegReq&quot;</span>);
      regreq-&gt;<a class="code" href="classMPCP.html#ac16411714bb8f9b3f4bc9e4fc88ae17f">setOpcode</a>(<a class="code" href="MPCP__codes_8h.html#a312e8c091a60aceac2ce2736d703fde5">MPCP_REGREQ</a>);
      regreq-&gt;<a class="code" href="classMPCPRegReq.html#ae00ff280cdd667c8c4bb8e303d890ba4">setPtpNumReq</a>(<a class="code" href="classONUQPerLLiDBase.html#a8cd7c92cd3cd0efd872428f145e2f995">numOfLLIDs</a>);

      regreq-&gt;setByteLength(<a class="code" href="MPCP__codes_8h.html#a53a5bdadb1af2c43add7d5e29f2b6d11">MPCP_HEADER_LEN</a>+<a class="code" href="MPCP__codes_8h.html#ac5c8425296d0d597cc31602ae00ee1c1">MPCP_LIST_LEN</a>);

      <span class="comment">// Send REG REQ and Schedule a timeout</span>
      <span class="comment">//send(regreq, &quot;lowerLayerOut&quot;);</span>

      <span class="comment">// Urb@n: Send directly on upstream to avoid collisions</span>
      regreq-&gt;addByteLength(PREAMBLE_BYTES);
      regreq-&gt;setSrc(<a class="code" href="classONUQPerLLiDBase.html#a4e9a1a4a48c094d0fd38302f5a5c6ccd" title="The Current ONU Optical MAC Address.">opt_mac</a>);
      sendDirect(regreq, <a class="code" href="classONUQPerLLiDBase.html#a4b6a938ce21d20c12e0e23e463ca063c" title="The OLT MAC module for direct delivery.">olt_mac</a>, <a class="code" href="classONUQPerLLiDBase.html#a4b6a938ce21d20c12e0e23e463ca063c" title="The OLT MAC module for direct delivery.">olt_mac</a>-&gt;gate(<span class="stringliteral">&quot;direct&quot;</span>)-&gt;getId());

      scheduleAt(simTime() +<a class="code" href="classONUQPerLLiDBase.html#ac606f2292264d63f9109f19bade56f6f">regTimeOut</a>, <a class="code" href="classONUQPerLLiDBase.html#a4dd8b975864c5097f6e76bcecc11dc86">regTOMsg</a> );
}
</pre></div>
</div>
</div>
<a class="anchor" id="affde37960d1ae9e3f070158113cd2554"></a><!-- doxytag: member="ONUQPerLLiDBase::startMPCPReg" ref="affde37960d1ae9e3f070158113cd2554" args="(uint32_t regMaxRandomSleep)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classONUQPerLLiDBase.html#affde37960d1ae9e3f070158113cd2554">ONUQPerLLiDBase::startMPCPReg</a> </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>regMaxRandomSleep</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializes the <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> registration process and sets the regTOMsg (TimeOut for the registration) </p>
<div class="fragment"><pre class="fragment">                                                            {

      uint32_t rndBackOff = dblrand() * regMaxRandomSleep;
      EV&lt;&lt;<span class="stringliteral">&quot;Sending MPCP REGREQ in &quot;</span> &lt;&lt; rndBackOff &lt;&lt; <span class="stringliteral">&quot;(&lt; &quot;</span> &lt;&lt;regMaxRandomSleep&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>&lt;&lt; endl;
      simtime_t t;
      t.setRaw(simTime().raw() + <a class="code" href="classMPCPTools.html#a1013f56301a3f993a5d30b238ac901cc">MPCPTools::ns16ToSimTime</a>(rndBackOff));
      scheduleAt(t, <a class="code" href="classONUQPerLLiDBase.html#a31fb7ad553ee17ddeb2ec4f244374c3f">regSendMsg</a> );
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a540b5c0e6f8ba974358e046a5dace738"></a><!-- doxytag: member="ONUQPerLLiDBase::allQsBlocked" ref="a540b5c0e6f8ba974358e046a5dace738" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classONUQPerLLiDBase.html#a540b5c0e6f8ba974358e046a5dace738">ONUQPerLLiDBase::allQsBlocked</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a799b3ac02ea7e3b7c1f4d513892bbe09"></a><!-- doxytag: member="ONUQPerLLiDBase::allQsEmpty" ref="a799b3ac02ea7e3b7c1f4d513892bbe09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classONUQPerLLiDBase.html#a799b3ac02ea7e3b7c1f4d513892bbe09">ONUQPerLLiDBase::allQsEmpty</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af154b7e6f824a455292ba4e11b5a4651"></a><!-- doxytag: member="ONUQPerLLiDBase::granularity" ref="af154b7e6f824a455292ba4e11b5a4651" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classONUQPerLLiDBase.html#af154b7e6f824a455292ba4e11b5a4651">ONUQPerLLiDBase::granularity</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Granularity of QoS limit (i.e. per second &lt;- most common) </p>

</div>
</div>
<a class="anchor" id="a8e650a7b93b1bc43e970bae41a2b95cf"></a><!-- doxytag: member="ONUQPerLLiDBase::nextQIndex" ref="a8e650a7b93b1bc43e970bae41a2b95cf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classONUQPerLLiDBase.html#a8e650a7b93b1bc43e970bae41a2b95cf">ONUQPerLLiDBase::nextQIndex</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a8cd7c92cd3cd0efd872428f145e2f995"></a><!-- doxytag: member="ONUQPerLLiDBase::numOfLLIDs" ref="a8cd7c92cd3cd0efd872428f145e2f995" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classONUQPerLLiDBase.html#a8cd7c92cd3cd0efd872428f145e2f995">ONUQPerLLiDBase::numOfLLIDs</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a4b6a938ce21d20c12e0e23e463ca063c"></a><!-- doxytag: member="ONUQPerLLiDBase::olt_mac" ref="a4b6a938ce21d20c12e0e23e463ca063c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cModule* <a class="el" href="classONUQPerLLiDBase.html#a4b6a938ce21d20c12e0e23e463ca063c">ONUQPerLLiDBase::olt_mac</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The OLT MAC module for direct delivery. </p>

</div>
</div>
<a class="anchor" id="a4e9a1a4a48c094d0fd38302f5a5c6ccd"></a><!-- doxytag: member="ONUQPerLLiDBase::opt_mac" ref="a4e9a1a4a48c094d0fd38302f5a5c6ccd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MACAddress <a class="el" href="classONUQPerLLiDBase.html#a4e9a1a4a48c094d0fd38302f5a5c6ccd">ONUQPerLLiDBase::opt_mac</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The Current ONU Optical MAC Address. </p>

</div>
</div>
<a class="anchor" id="a4a102747e626fc5d317810a9ad0b1ffb"></a><!-- doxytag: member="ONUQPerLLiDBase::pon_queues" ref="a4a102747e626fc5d317810a9ad0b1ffb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classONUQPerLLiDBase.html#adc4b0bd7a3ec2dace50ad78ef1714217">PonQueues</a> <a class="el" href="classONUQPerLLiDBase.html#a4a102747e626fc5d317810a9ad0b1ffb">ONUQPerLLiDBase::pon_queues</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a17a29180be1ca8f1e68a0b6bfe27e3e1"></a><!-- doxytag: member="ONUQPerLLiDBase::queueLimit" ref="a17a29180be1ca8f1e68a0b6bfe27e3e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classONUQPerLLiDBase.html#a17a29180be1ca8f1e68a0b6bfe27e3e1">ONUQPerLLiDBase::queueLimit</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a31fb7ad553ee17ddeb2ec4f244374c3f"></a><!-- doxytag: member="ONUQPerLLiDBase::regSendMsg" ref="a31fb7ad553ee17ddeb2ec4f244374c3f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage * <a class="el" href="classONUQPerLLiDBase.html#a31fb7ad553ee17ddeb2ec4f244374c3f">ONUQPerLLiDBase::regSendMsg</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac606f2292264d63f9109f19bade56f6f"></a><!-- doxytag: member="ONUQPerLLiDBase::regTimeOut" ref="ac606f2292264d63f9109f19bade56f6f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classONUQPerLLiDBase.html#ac606f2292264d63f9109f19bade56f6f">ONUQPerLLiDBase::regTimeOut</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a4dd8b975864c5097f6e76bcecc11dc86"></a><!-- doxytag: member="ONUQPerLLiDBase::regTOMsg" ref="a4dd8b975864c5097f6e76bcecc11dc86" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classONUQPerLLiDBase.html#a4dd8b975864c5097f6e76bcecc11dc86">ONUQPerLLiDBase::regTOMsg</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a81140d45b7b68a8c117daf43de2994e2"></a><!-- doxytag: member="ONUQPerLLiDBase::serviceList" ref="a81140d45b7b68a8c117daf43de2994e2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ServiceConfig_8h.html#aaf9dfd93fb9195bd4743e76b1a1ed879">SrvList</a>* <a class="el" href="classONUQPerLLiDBase.html#a81140d45b7b68a8c117daf43de2994e2">ONUQPerLLiDBase::serviceList</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="ONUQPerLLiDBase_8h.html">ONUQPerLLiDBase.h</a></li>
<li><a class="el" href="ONUQPerLLiDBase_8cc.html">ONUQPerLLiDBase.cc</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classONUQPerLLiDBase.html">ONUQPerLLiDBase</a>      </li>

    <li class="footer">Generated on Wed Oct 31 2012 20:10:52 for EPONImplementationforOMNet++ by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
