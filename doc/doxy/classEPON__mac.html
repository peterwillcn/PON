<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>EPONImplementationforOMNet++: EPON_mac Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">EPONImplementationforOMNet++
   &#160;<span id="projectnumber">0.8Beta</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classEPON__mac.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">EPON_mac Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="EPON_mac" -->
<p><a class="el" href="classEPON__mac.html" title="EPON_mac class is actually the EtherMAC2 class modified.">EPON_mac</a> class is actually the EtherMAC2 class modified.  
 <a href="classEPON__mac.html#details">More...</a></p>

<p><code>#include &lt;EPON_mac.h&gt;</code></p>

<p><a href="classEPON__mac-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a18ecaafc12641edd91e8f9da68cd6f31">EPON_mac</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a4966fa2fac2b970f19a54df51b4d7355">~EPON_mac</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a9c63bb76ade78c6cc46e3c93e7ec9f5d">initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a0d0bc4dcc1911d1e3378b8e8801f1461">finalize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a54d08d318c027a703d6d35d5ce6f77ea">initializeTxrate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a02ba48601e5e09ade42e3f9e78500f2f">handleMessage</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a0d08e9e7bca1dc0c4e594ac1c40a2fab">startFrameTransmission</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">When Tx starts we have already added Logical Link Identifier.  <a href="#a0d08e9e7bca1dc0c4e594ac1c40a2fab"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a917732c653ee80c33530e16a8721a309">processFrameFromUpperLayer</a> (EtherFrame *frame)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#ad9900db1020036f55846e7f5584503d3">processMsgFromNetwork</a> (cPacket *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#abe5bd67d0e3ea5af32e3e48cd9d3ffeb">handleEndIFGPeriod</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a5621adc5804efa6367710b3eb02c4b85">handleEndTxPeriod</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a1b03a533a8111a26e05307eb9ed07a83">updateHasSubcribers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#a46641d36cc5980d8ebe31b6dd184af3d">scheduleEndTxPeriod</a> (cPacket *frame)</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEPON__mac.html#aed2032fd6fb88c3ae07626246a56f07b">TxRateVector</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classEPON__mac.html" title="EPON_mac class is actually the EtherMAC2 class modified.">EPON_mac</a> class is actually the EtherMAC2 class modified. </p>
<p>From the INET framework documentation:</p>
<p>"A simplified version of EtherMAC. Since modern Ethernets typically operate over duplex links where's no contention, the original CSMA/CD algorithm is no longer needed. This simplified implementation doesn't contain CSMA/CD, frames are just simply queued and sent out one by one."</p>
<p>We use this class for some basic operations. The first one (and most important) is to change the way the frame is transmitted. On EPON network the Ethernet pre-amble includes the LLID (Logical Link ID). This LLID is carried, from the higher layers, inside the cMessage ControInfo. Thus what we do here is too remove the ControlInfo and use them in <a class="el" href="classEtherFrameWithLLID.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">EtherFrameWithLLID</a>. The original message is encapsulated inside this frame. Finally the preamble is added (-2 Bytes cause they are already in the <a class="el" href="classEtherFrameWithLLID.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">EtherFrameWithLLID</a>) and the SFD. For incoming frame from the network we do the opposite process (decapsulate the frame and add ControlInfo)</p>
<p>The second usage of this module is to handle the IFG times that, based on the drafts, should be there.</p>
<p>Finally note here that the basic control of the transmission times is located in the MacCtl modules (ONUMacCtl &amp; OLTMacCtl), thus most of the times the queue this module has is not used at all. </p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a18ecaafc12641edd91e8f9da68cd6f31"></a><!-- doxytag: member="EPON_mac::EPON_mac" ref="a18ecaafc12641edd91e8f9da68cd6f31" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEPON__mac.html#a18ecaafc12641edd91e8f9da68cd6f31">EPON_mac::EPON_mac</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4966fa2fac2b970f19a54df51b4d7355"></a><!-- doxytag: member="EPON_mac::~EPON_mac" ref="a4966fa2fac2b970f19a54df51b4d7355" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEPON__mac.html#a4966fa2fac2b970f19a54df51b4d7355">EPON_mac::~EPON_mac</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                   {
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;txQueue.length(); i++)
            <span class="keyword">delete</span> txQueue.pop();
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a0d0bc4dcc1911d1e3378b8e8801f1461"></a><!-- doxytag: member="EPON_mac::finalize" ref="a0d0bc4dcc1911d1e3378b8e8801f1461" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#a0d0bc4dcc1911d1e3378b8e8801f1461">EPON_mac::finalize</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                       {
      <span class="comment">// Do logging</span>
      <span class="keywordflow">if</span> (!disabled)
      {
            simtime_t t = simTime();
            <span class="keywordflow">if</span> (t&gt;0)
            {
<span class="comment">//                recordScalar(&quot;frames/sec sent&quot;, TxRateVector);</span>
            }
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="abe5bd67d0e3ea5af32e3e48cd9d3ffeb"></a><!-- doxytag: member="EPON_mac::handleEndIFGPeriod" ref="abe5bd67d0e3ea5af32e3e48cd9d3ffeb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#abe5bd67d0e3ea5af32e3e48cd9d3ffeb">EPON_mac::handleEndIFGPeriod</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classEPON__mac.html#abe5bd67d0e3ea5af32e3e48cd9d3ffeb">EtherMACBase::handleEndIFGPeriod</a>();

    <a class="code" href="classEPON__mac.html#a0d08e9e7bca1dc0c4e594ac1c40a2fab" title="When Tx starts we have already added Logical Link Identifier.">startFrameTransmission</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5621adc5804efa6367710b3eb02c4b85"></a><!-- doxytag: member="EPON_mac::handleEndTxPeriod" ref="a5621adc5804efa6367710b3eb02c4b85" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#a5621adc5804efa6367710b3eb02c4b85">EPON_mac::handleEndTxPeriod</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (hasSubscribers)
    {
        <span class="comment">// fire notification</span>
        notifDetails.setPacket((cPacket *)txQueue.front());
        nb-&gt;fireChangeNotification(NF_PP_TX_END, &amp;notifDetails);
    }

    <span class="keywordflow">if</span> (checkAndScheduleEndPausePeriod())
        <span class="keywordflow">return</span>;


    <span class="comment">// Deletes the frame... and log stats</span>
    <a class="code" href="classEPON__mac.html#a5621adc5804efa6367710b3eb02c4b85">EtherMACBase::handleEndTxPeriod</a>();


    beginSendFrames();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a02ba48601e5e09ade42e3f9e78500f2f"></a><!-- doxytag: member="EPON_mac::handleMessage" ref="a02ba48601e5e09ade42e3f9e78500f2f" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#a02ba48601e5e09ade42e3f9e78500f2f">EPON_mac::handleMessage</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!connected)
        processMessageWhenNotConnected(msg);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (disabled)
        processMessageWhenDisabled(msg);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;isSelfMessage())
    {
        EV &lt;&lt; <span class="stringliteral">&quot;Self-message &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; received\n&quot;</span>;

        <span class="keywordflow">if</span> (msg == endTxMsg)
            <a class="code" href="classEPON__mac.html#a5621adc5804efa6367710b3eb02c4b85">handleEndTxPeriod</a>();
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == endIFGMsg)
            <a class="code" href="classEPON__mac.html#abe5bd67d0e3ea5af32e3e48cd9d3ffeb">handleEndIFGPeriod</a>();
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == endPauseMsg)
            handleEndPausePeriod();
        <span class="keywordflow">else</span>
            error(<span class="stringliteral">&quot;Unknown self message received!&quot;</span>);
    }
    <span class="keywordflow">else</span>
    {
        <span class="keywordflow">if</span> (msg-&gt;getArrivalGate() == gate(<span class="stringliteral">&quot;upperLayerIn&quot;</span>))
            <a class="code" href="classEPON__mac.html#a917732c653ee80c33530e16a8721a309">processFrameFromUpperLayer</a>(check_and_cast&lt;EtherFrame *&gt;(msg));
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;getArrivalGate() == gate(<span class="stringliteral">&quot;phys$i&quot;</span>) ||
                  msg-&gt;getArrivalGate() == gate(<span class="stringliteral">&quot;direct&quot;</span>)) {
            <a class="code" href="classEPON__mac.html#ad9900db1020036f55846e7f5584503d3">processMsgFromNetwork</a>(check_and_cast&lt;cPacket *&gt;(msg));
        }<span class="keywordflow">else</span>
            error(<span class="stringliteral">&quot;Message received from unknown gate!&quot;</span>);
    }

    <span class="keywordflow">if</span> (ev.isGUI())  updateDisplayString();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9c63bb76ade78c6cc46e3c93e7ec9f5d"></a><!-- doxytag: member="EPON_mac::initialize" ref="a9c63bb76ade78c6cc46e3c93e7ec9f5d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#a9c63bb76ade78c6cc46e3c93e7ec9f5d">EPON_mac::initialize</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classEPON__mac.html#a9c63bb76ade78c6cc46e3c93e7ec9f5d">EtherMACBase::initialize</a>();

    duplexMode = <span class="keyword">true</span>;
    calculateParameters();

    beginSendFrames();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a54d08d318c027a703d6d35d5ce6f77ea"></a><!-- doxytag: member="EPON_mac::initializeTxrate" ref="a54d08d318c027a703d6d35d5ce6f77ea" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#a54d08d318c027a703d6d35d5ce6f77ea">EPON_mac::initializeTxrate</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
    <span class="comment">// if we&#39;re connected, find the gate with transmission rate</span>
    txrate = 0;

    <span class="keywordflow">if</span> (connected)
    {
        <span class="comment">// obtain txrate from channel. As a side effect, this also asserts</span>
        <span class="comment">// that the other end is an EPON_mac, since normal EtherMAC</span>
        <span class="comment">// insists that the connection has *no* datarate set.</span>
        <span class="comment">// if we&#39;re connected, get the gate with transmission rate</span>
        cChannel *datarateChannel = physOutGate-&gt;getTransmissionChannel();
        txrate = datarateChannel-&gt;par(<span class="stringliteral">&quot;datarate&quot;</span>).doubleValue();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a917732c653ee80c33530e16a8721a309"></a><!-- doxytag: member="EPON_mac::processFrameFromUpperLayer" ref="a917732c653ee80c33530e16a8721a309" args="(EtherFrame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#a917732c653ee80c33530e16a8721a309">EPON_mac::processFrameFromUpperLayer</a> </td>
          <td>(</td>
          <td class="paramtype">EtherFrame *&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
      EV &lt;&lt; <span class="stringliteral">&quot;Received frame from upper layer: &quot;</span> &lt;&lt; frame &lt;&lt; endl;

      <span class="keywordflow">if</span> (frame-&gt;getDest().equals(address))
      {
            error(<span class="stringliteral">&quot;logic error: frame %s from higher layer has local MAC address as dest (%s)&quot;</span>,
                    frame-&gt;getFullName(), frame-&gt;getDest().str().c_str());
      }

      <span class="keywordflow">if</span> (frame-&gt;getByteLength() &gt; MAX_ETHERNET_FRAME_D1Q)
            error(<span class="stringliteral">&quot;packet from higher layer (%d bytes) exceeds maximum Ethernet frame size (%d)&quot;</span>, frame-&gt;getByteLength(), MAX_ETHERNET_FRAME_D1Q);

      <span class="comment">// must be EtherFrame (or EtherPauseFrame) from upper layer</span>
      <span class="keywordtype">bool</span> isPauseFrame = (<span class="keyword">dynamic_cast&lt;</span>EtherPauseFrame*<span class="keyword">&gt;</span>(frame)!=NULL);
      <span class="keywordflow">if</span> (!isPauseFrame)
      {
            numFramesFromHL++;

            <span class="keywordflow">if</span> (txQueueLimit &amp;&amp; txQueue.length()&gt;txQueueLimit)
                  error(<span class="stringliteral">&quot;txQueue length exceeds %d -- this is probably due to &quot;</span>
                          <span class="stringliteral">&quot;a bogus app model generating excessive traffic &quot;</span>
                          <span class="stringliteral">&quot;(or if this is normal, increase txQueueLimit!)&quot;</span>,
                          txQueueLimit);

            <span class="comment">// fill in src address if not set</span>
            <span class="keywordflow">if</span> (frame-&gt;getSrc().isUnspecified())
                  frame-&gt;setSrc(address);


             <span class="comment">// Note: take the control from the origial frame. Dup() does not clone it.</span>
            <a class="code" href="classEPON__LLidCtrlInfo.html" title="EPON_LLidCtrlInfo extends cObject and is used for ControlInfo carried in the messages.">EPON_LLidCtrlInfo</a> *nfo=<span class="keyword">dynamic_cast&lt;</span><a class="code" href="classEPON__LLidCtrlInfo.html" title="EPON_LLidCtrlInfo extends cObject and is used for ControlInfo carried in the messages.">EPON_LLidCtrlInfo</a> *<span class="keyword">&gt;</span>(frame-&gt;getControlInfo());
            <a class="code" href="classEtherFrameWithLLID.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">EtherFrameWithLLID</a> * llid_eth = <span class="keyword">new</span> <a class="code" href="classEtherFrameWithLLID.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">EtherFrameWithLLID</a>();
            llid_eth-&gt;setName(frame-&gt;getName());

            <span class="keywordflow">if</span> (nfo != NULL){
                  EV &lt;&lt; <span class="stringliteral">&quot;Control Info FOUND&quot;</span>&lt;&lt;endl;
                  <span class="comment">// Convert to EtherFrameWithLLID</span>

                  uint16_t tmpLlid = nfo-&gt;<a class="code" href="classEPON__LLidCtrlInfo.html#a22816820608cef4293a7c296d3de8734">llid</a>;
                  <span class="comment">// Relay didn&#39;t knew the llid...</span>
                  <span class="keywordflow">if</span> (tmpLlid == -1)
                        tmpLlid=<a class="code" href="EPON__CtrlInfo_8h.html#a9c30e6b907d649b65497274b020a3537">LLID_EPON_BC</a>;
                  llid_eth-&gt;<a class="code" href="classEtherFrameWithLLID.html#a5d8b3961d58a4c0cea7715403e4d0666">setLlid</a>(tmpLlid);
            }<span class="keywordflow">else</span>{
            <span class="comment">// MPCP Frames may not have LLIDs</span>
            <span class="comment">// Encapsulate BC</span>
                  uint16_t tmpLlid = <a class="code" href="EPON__CtrlInfo_8h.html#a9c30e6b907d649b65497274b020a3537">LLID_EPON_BC</a>;
                  llid_eth-&gt;<a class="code" href="classEtherFrameWithLLID.html#a5d8b3961d58a4c0cea7715403e4d0666">setLlid</a>(tmpLlid);
          }


            <span class="comment">/*</span>
<span class="comment">             * YOU HAVE TO MANUALLY SET THE BYTE LENGTH...</span>
<span class="comment">             */</span>
            llid_eth-&gt;addByteLength(2);   <span class="comment">// add for the 2 bytes in the preamble</span>
            frame-&gt;addByteLength(<a class="code" href="EPON__mac_8h.html#a3f4fd28a4e1ca4668edf923b7dc924d9">EPON_PREAMBLE_BYTES</a>+SFD_BYTES); <span class="comment">// add the rest</span>
            llid_eth-&gt;encapsulate(frame);
            <span class="comment">//frame=NULL;</span>

            <span class="comment">// store frame and possibly begin transmitting</span>
            EV &lt;&lt; <span class="stringliteral">&quot;Packet &quot;</span> &lt;&lt; llid_eth &lt;&lt; <span class="stringliteral">&quot; arrived from higher layers, enqueueing\n&quot;</span>;
            EV &lt;&lt; <span class="stringliteral">&quot;After enc Size &quot;</span> &lt;&lt; llid_eth-&gt;getByteLength()&lt;&lt; <span class="stringliteral">&quot; \n&quot;</span>;
            EV &lt;&lt; <span class="stringliteral">&quot;Orig. Size &quot;</span> &lt;&lt; frame-&gt;getByteLength()&lt;&lt; <span class="stringliteral">&quot; \n&quot;</span>;

            txQueue.insert(llid_eth);

      }
      <span class="keywordflow">else</span>
      {
            EV &lt;&lt; <span class="stringliteral">&quot;PAUSE received from higher layer\n&quot;</span>;

            <span class="comment">// PAUSE frames enjoy priority -- they&#39;re transmitted before all other frames queued up</span>
            <span class="keywordflow">if</span> (!txQueue.empty())
                  txQueue.insertBefore(txQueue.front(), frame);  <span class="comment">// front() frame is probably being transmitted</span>
            <span class="keywordflow">else</span>
                  txQueue.insert(frame);
      }


      <span class="comment">// In any case, wait for IFG before transmitting</span>
    <span class="keywordflow">if</span> (transmitState == TX_IDLE_STATE)
      scheduleEndIFGPeriod();
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad9900db1020036f55846e7f5584503d3"></a><!-- doxytag: member="EPON_mac::processMsgFromNetwork" ref="ad9900db1020036f55846e7f5584503d3" args="(cPacket *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#ad9900db1020036f55846e7f5584503d3">EPON_mac::processMsgFromNetwork</a> </td>
          <td>(</td>
          <td class="paramtype">cPacket *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
    <span class="comment">//EtherMACBase::processMsgFromNetwork(msg);</span>
      <span class="comment">// the original ^ checks for frame type and for cable length...</span>
      <span class="comment">// both not applicable here...</span>

       EtherFrame *ethframe = <span class="keyword">dynamic_cast&lt;</span>EtherFrame *<span class="keyword">&gt;</span>(msg);
       <a class="code" href="classEtherFrameWithLLID.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">EtherFrameWithLLID</a> * ethllid= <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classEtherFrameWithLLID.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">EtherFrameWithLLID</a> *<span class="keyword">&gt;</span>(msg);

      <span class="keywordflow">if</span> ( ethframe== NULL &amp;&amp; ethllid== NULL){
            error(<span class="stringliteral">&quot;EPON_mac: Unrecognized Frame... Shit happens&quot;</span>);
      }

      <span class="comment">// IF we have EPON frame with LLID de-capsulate</span>
      <span class="keywordflow">if</span> (ethllid){
            ethframe = check_and_cast&lt;EtherFrame *&gt;(ethllid-&gt;decapsulate());
            <span class="keyword">delete</span> ethllid-&gt;decapsulate();
            <span class="comment">// Add Control Information to it</span>
            EV &lt;&lt; <span class="stringliteral">&quot;IT HAD LLID INFO ... : &quot;</span>&lt;&lt;ethllid-&gt;<a class="code" href="classEtherFrameWithLLID.html#aaadd9ee32a45636ee1bef66a5aff79e9">getLlid</a>()&lt;&lt;endl;
            <span class="keywordflow">if</span> (ethframe-&gt;getControlInfo()==NULL)
            ethframe-&gt;setControlInfo(<span class="keyword">new</span> <a class="code" href="classEPON__LLidCtrlInfo.html" title="EPON_LLidCtrlInfo extends cObject and is used for ControlInfo carried in the messages.">EPON_LLidCtrlInfo</a>(ethllid-&gt;<a class="code" href="classEtherFrameWithLLID.html#aaadd9ee32a45636ee1bef66a5aff79e9">getLlid</a>()) );
            <span class="comment">// Add original pre-amble.. to be used from the base class...</span>
            ethframe-&gt;addByteLength(-<a class="code" href="EPON__mac_8h.html#a3f4fd28a4e1ca4668edf923b7dc924d9">EPON_PREAMBLE_BYTES</a>);
            ethframe-&gt;addByteLength(PREAMBLE_BYTES);
            <span class="comment">// Get rid of the original</span>
            <span class="keyword">delete</span> msg;
      }



    <span class="keywordflow">if</span> (hasSubscribers)
    {
        <span class="comment">// fire notification</span>
        notifDetails.setPacket(ethframe);
        nb-&gt;fireChangeNotification(NF_PP_RX_END, &amp;notifDetails);
    }

    <span class="keywordflow">if</span> (checkDestinationAddress(ethframe))
        frameReceptionComplete(ethframe);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a46641d36cc5980d8ebe31b6dd184af3d"></a><!-- doxytag: member="EPON_mac::scheduleEndTxPeriod" ref="a46641d36cc5980d8ebe31b6dd184af3d" args="(cPacket *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#a46641d36cc5980d8ebe31b6dd184af3d">EPON_mac::scheduleEndTxPeriod</a> </td>
          <td>(</td>
          <td class="paramtype">cPacket *&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
      <a class="code" href="classEPON__mac.html#a46641d36cc5980d8ebe31b6dd184af3d">EtherMACBase::scheduleEndTxPeriod</a>(frame);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0d08e9e7bca1dc0c4e594ac1c40a2fab"></a><!-- doxytag: member="EPON_mac::startFrameTransmission" ref="a0d08e9e7bca1dc0c4e594ac1c40a2fab" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#a0d08e9e7bca1dc0c4e594ac1c40a2fab">EPON_mac::startFrameTransmission</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>When Tx starts we have already added Logical Link Identifier. </p>
<div class="fragment"><pre class="fragment">{
      <a class="code" href="classEtherFrameWithLLID.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">EtherFrameWithLLID</a> *origFrame = (<a class="code" href="classEtherFrameWithLLID.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">EtherFrameWithLLID</a> *)txQueue.front();
    EV &lt;&lt; <span class="stringliteral">&quot;Transmitting a copy of frame &quot;</span> &lt;&lt; origFrame &lt;&lt; endl;

    <a class="code" href="classEtherFrameWithLLID.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">EtherFrameWithLLID</a> *frame = (<a class="code" href="classEtherFrameWithLLID.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">EtherFrameWithLLID</a> *) origFrame-&gt;<a class="code" href="classEtherFrameWithLLID.html#acbda77c06c3f06412f91326c91e51fab">dup</a>();

    <span class="keywordflow">if</span> (hasSubscribers)
    {
        <span class="comment">// fire notification</span>
        notifDetails.setPacket(frame);
        nb-&gt;fireChangeNotification(NF_PP_TX_BEGIN, &amp;notifDetails);
    }

    <span class="comment">// fill in src address if not set</span>
<span class="comment">//    if (frame-&gt;getSrc().isUnspecified())</span>
<span class="comment">//        frame-&gt;setSrc(address);</span>

    <span class="comment">// send</span>
    EV &lt;&lt; <span class="stringliteral">&quot;Starting transmission of &quot;</span> &lt;&lt; frame &lt;&lt; endl;
    send(frame, physOutGate);
    <a class="code" href="classEPON__mac.html#a46641d36cc5980d8ebe31b6dd184af3d">scheduleEndTxPeriod</a>(frame);

    <span class="comment">// update burst variables</span>
    <span class="keywordflow">if</span> (frameBursting)
    {
        bytesSentInBurst = frame-&gt;getByteLength();
        framesSentInBurst++;
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="a1b03a533a8111a26e05307eb9ed07a83"></a><!-- doxytag: member="EPON_mac::updateHasSubcribers" ref="a1b03a533a8111a26e05307eb9ed07a83" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classEPON__mac.html#a1b03a533a8111a26e05307eb9ed07a83">EPON_mac::updateHasSubcribers</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{
    hasSubscribers = nb-&gt;hasSubscribers(NF_PP_TX_BEGIN) ||
                     nb-&gt;hasSubscribers(NF_PP_TX_END) ||
                     nb-&gt;hasSubscribers(NF_PP_RX_END);
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aed2032fd6fb88c3ae07626246a56f07b"></a><!-- doxytag: member="EPON_mac::TxRateVector" ref="aed2032fd6fb88c3ae07626246a56f07b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector <a class="el" href="classEPON__mac.html#aed2032fd6fb88c3ae07626246a56f07b">EPON_mac::TxRateVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="EPON__mac_8h.html">EPON_mac.h</a></li>
<li><a class="el" href="EPON__mac_8cc.html">EPON_mac.cc</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classEPON__mac.html">EPON_mac</a>      </li>

    <li class="footer">Generated on Wed Oct 31 2012 20:10:48 for EPONImplementationforOMNet++ by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
