<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>EPONImplementationforOMNet++: OLTQPerLLiDBase Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">EPONImplementationforOMNet++
   &#160;<span id="projectnumber">0.8Beta</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classOLTQPerLLiDBase.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">OLTQPerLLiDBase Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OLTQPerLLiDBase" -->
<p>OLT_Q_mgmt_PerLLiD creates on queue per MAC-LLID tuple.  
 <a href="classOLTQPerLLiDBase.html#details">More...</a></p>

<p><code>#include &lt;OLTQPerLLiDBase.h&gt;</code></p>
<div class="dynheader">
Inheritance diagram for OLTQPerLLiDBase:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classOLTQPerLLiDBase.png" usemap="#OLTQPerLLiDBase_map" alt=""/>
  <map id="OLTQPerLLiDBase_map" name="OLTQPerLLiDBase_map">
<area href="classOLT__QPL__RR.html" alt="OLT_QPL_RR" shape="rect" coords="0,56,135,80"/>
<area href="classOLTQPerLLiDBase__P.html" title="Polling algorithm base." alt="OLTQPerLLiDBase_P" shape="rect" coords="0,112,135,136"/>
</map>
 </div></div>

<p><a href="classOLTQPerLLiDBase-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a1e0364756c83f3ec7e58bf99d998b7e7">OLTQPerLLiDBase</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a608248f311a9182c347d6bb0c269589f">~OLTQPerLLiDBase</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-types"></a>
Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::vector<br class="typebreak"/>
&lt; <a class="el" href="classQueuePerMacLLid.html">QueuePerMacLLid</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a9ea8edadd43bff7481f16930d6a6a999">PonQueues</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The vector holding the queues.  <a href="#a9ea8edadd43bff7481f16930d6a6a999"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a56f0e4d9c8a7d9177f52d2e24fc32dc4">initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#aea4abf74f75dd5a775c7cbe5737814f7">finish</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#ab62b5af40ff70e244e7ea0b7e5c16384">handleMessage</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a6d6776a7367adb7563036c61828614ff">processFrameFromHigherLayer</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#af79fad010fc8bd1079fb7e9bc74eed70">processFrameFromLowerLayer</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#afd30699aca06198af9f2b4bc6c97363b">processMPCP</a> (EthernetIIFrame *frame)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Do <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> stuff.  <a href="#afd30699aca06198af9f2b4bc6c97363b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a4d573a9cf345c1571a99a76c8d043c18">handleRegTimeOut</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#ac600adb76bc73ad954824a2ecd9c0941">handleMPCPReport</a> (<a class="el" href="classMPCPReport.html">MPCPReport</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a7c35ae769a03b76bbe8126e51d0a14da">doOnuRegistration</a> (MACAddress mac)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual cModule *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#ad545dae8caa70624543e6070dab784c3">findModuleUp</a> (const char *name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a9ae0e3660e3eb2e9d2d8fa0fec3b3819">createONU_Q</a> (<a class="el" href="classONUTableEntry.html">ONUTableEntry</a> &amp;en)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new queue for an entry in the ONU table.  <a href="#a9ae0e3660e3eb2e9d2d8fa0fec3b3819"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a05b4aa91883a31fe41f0f03b0ca2ac9c">existsInPONQueues</a> (mac_llid ml)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a14b5151c2f664d3d362076af3e2608d8">DoUpstreamDBA</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method calculates the upstream timers for each ONU in the <a class="el" href="classONUTable.html" title="A simple class containing a vector of ONUTableEntry objects.">ONUTable</a>.  <a href="#a14b5151c2f664d3d362076af3e2608d8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a7b3af2ae6072f4de1709afac5f2beabf">sendMPCPGateReg</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate and send the initial gate message.  <a href="#a7b3af2ae6072f4de1709afac5f2beabf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a5fd4b38cc1e85328f59d3880533f95dd">SendGateUpdates</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate <a class="el" href="classMPCPGate.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPGate</a> messages announcing the transmission times to the ONUs.  <a href="#a5fd4b38cc1e85328f59d3880533f95dd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a3c818f0cf98b25bf2932d9bda3778fed">checkIfAllEmpty</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check is all the Qs are empty.  <a href="#a3c818f0cf98b25bf2932d9bda3778fed"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#afc869f34f115c1fc1060058a965e90ca">getIndexForLLID</a> (uint16_t llid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a5e35308e217b610871382c48c99f486a">addSortedMacLLID</a> (<a class="el" href="classQueuePerMacLLid.html">QueuePerMacLLid</a> tmp_qpml)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a new queue to the pon_queues sorted by priority Higher priority Qs go up.  <a href="#a5e35308e217b610871382c48c99f486a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classQueuePerMacLLid.html">QueuePerMacLLid</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a875a2f65e8834a78735355bd2fb4ff31">getFastestQForMac</a> (const MACAddress &amp;mac)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the higher priority queue for the specified MAC address.  <a href="#a875a2f65e8834a78735355bd2fb4ff31"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classQueuePerMacLLid.html">QueuePerMacLLid</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#acbbe22dca7282fb4a503433128347aea">getFastestQForMac</a> (const std::string &amp;mac)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the higher priority queue for the specified MAC address.  <a href="#acbbe22dca7282fb4a503433128347aea"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#af22b390c95b2e6e4bef0c46ad4b6a378">getFastestLLiDForMac</a> (const std::string &amp;mac)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a8ef5e93102e04083f7d57a2e029a227d">isEmpty</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#ae749241094a6d45b12426ac4c6bf4cd8">getSuperSlot_ns</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the Super Slot length (ns)  <a href="#ae749241094a6d45b12426ac4c6bf4cd8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a3a4b73f411413dbca9945dca09dc12de">getSuperSlot_sec</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the Super Slot length (sec).  <a href="#a3a4b73f411413dbca9945dca09dc12de"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classONUTable.html">ONUTable</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">vector&lt; <a class="el" href="classONUTableEntry.html">ONUTableEntry</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a6d23ac5f1c08a034bd27fc1ddec7e831">temptbl</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">vector&lt; cMessage * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="ServiceConfig_8h.html#aaf9dfd93fb9195bd4743e76b1a1ed879">SrvList</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#af3963c88dc900bb37cab7d77470fb85a">serviceList</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a9ea4fc3a41a8f53e87b225f518e7a7a0">regAckTimeOut</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a8208316cdc8ed31382ff6c52351c29d9">slotLength</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a97db811dcd4d4306e051b7d2bf2aee21">slotNumber</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#acafc52f42287fda0adda85ebe95bd316">regTimeInt</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a7762bc61444ff9f6a7de825b307465fe">queueLimit</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#ab687a7ea8997f7b21ab977fee6a6dc66">datarateLimit</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classOLTQPerLLiDBase.html#a9ea8edadd43bff7481f16930d6a6a999">PonQueues</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#ae3e75c9e3058800bee83b9b07c324710">allQsEmpty</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOLTQPerLLiDBase.html#a5a5c6a8009ac4e5d596e28be1f05f908">nextQIndex</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>OLT_Q_mgmt_PerLLiD creates on queue per MAC-LLID tuple. </p>
<p>Here is actually done all the bandwidth allocation and timer calculation. Also this class handles the ONU registration and the updates the ONU table. Thus some <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> messages are generated from here and timeouts are defined here. Now since all the time management is done here... we have to define the number of time slots and the time slot duration. Finally this class is aware of any services in this network and thus has a pointer to the SrvList class (if any module is available in the scenario else it is NULL).</p>
<p>The whole idea is to extend this class and create your own bandwidth allocation algorithms. The default behavior of this class is to apply round robin on the queues (per frame). The only thing considered is the priority (not strictly) and happens because the queues are sorted based on the service priority.</p>
<p>Basic methods that would be useful to override when you extend are explained below. </p>
</div><hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="a9ea8edadd43bff7481f16930d6a6a999"></a><!-- doxytag: member="OLTQPerLLiDBase::PonQueues" ref="a9ea8edadd43bff7481f16930d6a6a999" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::vector&lt;<a class="el" href="classQueuePerMacLLid.html">QueuePerMacLLid</a>&gt; <a class="el" href="classOLTQPerLLiDBase.html#a9ea8edadd43bff7481f16930d6a6a999">OLTQPerLLiDBase::PonQueues</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The vector holding the queues. </p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a1e0364756c83f3ec7e58bf99d998b7e7"></a><!-- doxytag: member="OLTQPerLLiDBase::OLTQPerLLiDBase" ref="a1e0364756c83f3ec7e58bf99d998b7e7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classOLTQPerLLiDBase.html#a1e0364756c83f3ec7e58bf99d998b7e7">OLTQPerLLiDBase::OLTQPerLLiDBase</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{}
</pre></div>
</div>
</div>
<a class="anchor" id="a608248f311a9182c347d6bb0c269589f"></a><!-- doxytag: member="OLTQPerLLiDBase::~OLTQPerLLiDBase" ref="a608248f311a9182c347d6bb0c269589f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classOLTQPerLLiDBase.html#a608248f311a9182c347d6bb0c269589f">OLTQPerLLiDBase::~OLTQPerLLiDBase</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                 {
      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>.size(); i++){
            cancelAndDelete((cMessage *)<a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>[i]);
      }

      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.size(); i++){
            <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].clean();
      }
      <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.clear();
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a5e35308e217b610871382c48c99f486a"></a><!-- doxytag: member="OLTQPerLLiDBase::addSortedMacLLID" ref="a5e35308e217b610871382c48c99f486a" args="(QueuePerMacLLid tmp_qpml)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#a5e35308e217b610871382c48c99f486a">OLTQPerLLiDBase::addSortedMacLLID</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classQueuePerMacLLid.html">QueuePerMacLLid</a>&#160;</td>
          <td class="paramname"><em>tmp_qpml</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a new queue to the pon_queues sorted by priority Higher priority Qs go up. </p>
<div class="fragment"><pre class="fragment">                                                              {
      <span class="comment">// Just add it if empty...</span>
      <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.empty()) {
            <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.push_back(tmp_qpml);
            <span class="keywordflow">return</span>;
      }

      <span class="comment">// Add in the proper position</span>
      <span class="keywordflow">for</span> (PonQueues::iterator it = <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.begin(); it != <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.end(); it++){
            <span class="keywordflow">if</span> ((*it).prior &lt; tmp_qpml.prior){
                  <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.insert(it, tmp_qpml);
                  <span class="keywordflow">return</span>;
            }
      }

      <span class="comment">// If not added till here... add to the end</span>
      <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.push_back(tmp_qpml);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c818f0cf98b25bf2932d9bda3778fed"></a><!-- doxytag: member="OLTQPerLLiDBase::checkIfAllEmpty" ref="a3c818f0cf98b25bf2932d9bda3778fed" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#a3c818f0cf98b25bf2932d9bda3778fed">OLTQPerLLiDBase::checkIfAllEmpty</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check is all the Qs are empty. </p>
<p>IF yes set the all empty variable. This must be done after the frame request from the lower layer. </p>
<div class="fragment"><pre class="fragment">                                     {
      <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.size() == 0) <a class="code" href="classOLTQPerLLiDBase.html#ae3e75c9e3058800bee83b9b07c324710">allQsEmpty</a> = <span class="keyword">true</span>;
      <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[0].<a class="code" href="classOLTQPerLLiDBase.html#a8ef5e93102e04083f7d57a2e029a227d">isEmpty</a>()
                  &amp;&amp; <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.size() == 1) <a class="code" href="classOLTQPerLLiDBase.html#ae3e75c9e3058800bee83b9b07c324710">allQsEmpty</a> = <span class="keyword">true</span>;


      <span class="keywordflow">for</span> (uint32_t i=0; i&lt; <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.size(); i++){
            <span class="keywordflow">if</span> (!<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].<a class="code" href="classOLTQPerLLiDBase.html#a8ef5e93102e04083f7d57a2e029a227d">isEmpty</a>()){
                  <a class="code" href="classOLTQPerLLiDBase.html#ae3e75c9e3058800bee83b9b07c324710">allQsEmpty</a> = <span class="keyword">false</span>;
                  <span class="keywordflow">return</span>;
            }
      }

      <a class="code" href="classOLTQPerLLiDBase.html#ae3e75c9e3058800bee83b9b07c324710">allQsEmpty</a> = <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9ae0e3660e3eb2e9d2d8fa0fec3b3819"></a><!-- doxytag: member="OLTQPerLLiDBase::createONU_Q" ref="a9ae0e3660e3eb2e9d2d8fa0fec3b3819" args="(ONUTableEntry &amp;en)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#a9ae0e3660e3eb2e9d2d8fa0fec3b3819">OLTQPerLLiDBase::createONU_Q</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classONUTableEntry.html">ONUTableEntry</a> &amp;&#160;</td>
          <td class="paramname"><em>en</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a new queue for an entry in the ONU table. </p>
<p>This method also calls the <a class="el" href="classOLTQPerLLiDBase.html#a14b5151c2f664d3d362076af3e2608d8" title="This method calculates the upstream timers for each ONU in the ONUTable.">DoUpstreamDBA()</a> to calculate the new granted times and finally calls the <a class="el" href="classOLTQPerLLiDBase.html#a5fd4b38cc1e85328f59d3880533f95dd" title="Generate MPCPGate messages announcing the transmission times to the ONUs.">SendGateUpdates()</a> to announce these to the ONUs. </p>
<div class="fragment"><pre class="fragment">                                                  {

      mac_llid tmp_ml;
      tmp_ml.mac = en.<a class="code" href="classONUTableEntry.html#acd4a5a20f01a363c305ea401e5473555">getId</a>();
      <span class="comment">// Scan llids</span>
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;en.<a class="code" href="classONUTableEntry.html#ac5f10c076edfc5c4365b095b1d5d95fa">getLLIDsNum</a>(); j++){

            tmp_ml.llid = en.<a class="code" href="classONUTableEntry.html#ae9d1853ee18e69e6d8fbf6b7371cbf2a">getLLID</a>(j);

            <a class="code" href="classQueuePerMacLLid.html" title="Allocation per MAC-LLID.">QueuePerMacLLid</a> tmp_q;
            tmp_q.<a class="code" href="classQueuePerMacLLid.html#aa106b8124df1194bcc777c3edd6d958b">ml</a> = tmp_ml;
            <span class="keywordtype">char</span> tmp_name[20];
            sprintf(tmp_name,<span class="stringliteral">&quot;Default-%d&quot;</span>,tmp_ml.llid);

            tmp_q.prior = 0.0;

            <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#af3963c88dc900bb37cab7d77470fb85a">serviceList</a> &amp;&amp; (<span class="keywordtype">int</span>)<a class="code" href="classOLTQPerLLiDBase.html#af3963c88dc900bb37cab7d77470fb85a">serviceList</a>-&gt;size() &gt; j) {
                  sprintf(tmp_name,<span class="stringliteral">&quot;%s-%d&quot;</span>,<a class="code" href="classOLTQPerLLiDBase.html#af3963c88dc900bb37cab7d77470fb85a">serviceList</a>-&gt;at(j).name.c_str(),tmp_ml.llid);
                  tmp_q.prior = <a class="code" href="classOLTQPerLLiDBase.html#af3963c88dc900bb37cab7d77470fb85a">serviceList</a>-&gt;at(j).priority;
                  tmp_q.<a class="code" href="classQueuePerMacLLid.html#a20c92c28e117c8d85733bb15bc788f0a">isDefault</a> = <span class="keyword">false</span>;
            }

            <span class="comment">// Use the last LLiD as the default</span>
            <span class="keywordflow">if</span> ( en.<a class="code" href="classONUTableEntry.html#ac5f10c076edfc5c4365b095b1d5d95fa">getLLIDsNum</a>() -1 == j){
                  EV &lt;&lt; <span class="stringliteral">&quot;Registering the default LLiD (BE) to &quot;</span>&lt;&lt;tmp_ml.llid&lt;&lt;endl;
                  sprintf(tmp_name,<span class="stringliteral">&quot;%s-%d&quot;</span>,<span class="stringliteral">&quot;Default&quot;</span>,tmp_ml.llid);
                  tmp_q.prior = 0.0001;
                  tmp_q.<a class="code" href="classQueuePerMacLLid.html#a20c92c28e117c8d85733bb15bc788f0a">isDefault</a> = <span class="keyword">true</span>;
            }

            tmp_q.setServiceName(tmp_name);
            <a class="code" href="classOLTQPerLLiDBase.html#a5e35308e217b610871382c48c99f486a" title="Add a new queue to the pon_queues sorted by priority Higher priority Qs go up.">addSortedMacLLID</a>(tmp_q);


      }

      <span class="comment">// Do Upstream DBA and calculate tx timers</span>
      <a class="code" href="classOLTQPerLLiDBase.html#a14b5151c2f664d3d362076af3e2608d8" title="This method calculates the upstream timers for each ONU in the ONUTable.">DoUpstreamDBA</a>();
      <span class="comment">// Announce these timers to the ONUs</span>
      <a class="code" href="classOLTQPerLLiDBase.html#a5fd4b38cc1e85328f59d3880533f95dd" title="Generate MPCPGate messages announcing the transmission times to the ONUs.">SendGateUpdates</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7c35ae769a03b76bbe8126e51d0a14da"></a><!-- doxytag: member="OLTQPerLLiDBase::doOnuRegistration" ref="a7c35ae769a03b76bbe8126e51d0a14da" args="(MACAddress mac)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#a7c35ae769a03b76bbe8126e51d0a14da">OLTQPerLLiDBase::doOnuRegistration</a> </td>
          <td>(</td>
          <td class="paramtype">MACAddress&#160;</td>
          <td class="paramname"><em>mac</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                     {
      <span class="comment">// Find Entry Index....</span>
      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classOLTQPerLLiDBase.html#a6d23ac5f1c08a034bd27fc1ddec7e831">temptbl</a>.size(); i++){
            <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#a6d23ac5f1c08a034bd27fc1ddec7e831">temptbl</a>.at(i).getId() == mac){
                  EV &lt;&lt; <span class="stringliteral">&quot;OLTMacCtl: ONU (MAC: &quot;</span>&lt;&lt;mac&lt;&lt;<span class="stringliteral">&quot;) request &quot;</span>&lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; Registered&quot;</span>&lt;&lt;endl;
                  <span class="comment">// Clear message and move tb entry to the global</span>
                  cancelAndDelete(<a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>[i]);
                  <a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>.erase(<a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>.begin()+i);

                  <span class="comment">// Copy</span>
                  <a class="code" href="classONUTableEntry.html" title="This class holds a single ONUTable entry...">ONUTableEntry</a> en=<a class="code" href="classOLTQPerLLiDBase.html#a6d23ac5f1c08a034bd27fc1ddec7e831">temptbl</a>.at(i);
                  <a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>-&gt;<a class="code" href="classONUTable.html#a626fcb83683377f57134b94a4228b239">addONU</a>(en);

                  <span class="comment">// Remove from tmp</span>
                  <span class="comment">//temptbl.removeONU(i);</span>
                  <a class="code" href="classOLTQPerLLiDBase.html#a6d23ac5f1c08a034bd27fc1ddec7e831">temptbl</a>.erase(<a class="code" href="classOLTQPerLLiDBase.html#a6d23ac5f1c08a034bd27fc1ddec7e831">temptbl</a>.begin()+i);
                  <a class="code" href="classOLTQPerLLiDBase.html#a9ae0e3660e3eb2e9d2d8fa0fec3b3819" title="Create a new queue for an entry in the ONU table.">createONU_Q</a>(en);

                  <span class="keywordflow">break</span>;
            }
      }


}
</pre></div>
</div>
</div>
<a class="anchor" id="a14b5151c2f664d3d362076af3e2608d8"></a><!-- doxytag: member="OLTQPerLLiDBase::DoUpstreamDBA" ref="a14b5151c2f664d3d362076af3e2608d8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#a14b5151c2f664d3d362076af3e2608d8">OLTQPerLLiDBase::DoUpstreamDBA</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method calculates the upstream timers for each ONU in the <a class="el" href="classONUTable.html" title="A simple class containing a vector of ONUTableEntry objects.">ONUTable</a>. </p>
<p>Fair Allocation per MAC-LLID with LIMIT.</p>
<p>This could be overridden to change the default behavior. The default is fair allocation per ONU.</p>
<p>In addition this method scale down the simulation data rates. If datarateLimit is set &gt; 0 then only this is going to be allocated to the ONUs.</p>
<p>FOR NON-POLLING ALGORITHMS 2 Basic RULES At the end this method should: <br/>
</p>
<ul>
<li>Have set the _total_ length and start registers on the ONU table</li>
<li>Call <a class="el" href="classOLTQPerLLiDBase.html#a5fd4b38cc1e85328f59d3880533f95dd" title="Generate MPCPGate messages announcing the transmission times to the ONUs.">SendGateUpdates()</a> to announce to ONUs</li>
</ul>
<p>FOR POLLING ALGORITHMS this method should:<br/>
</p>
<ul>
<li>Be called periodically to handle the next ONU (poll)</li>
<li>It should schedule the <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> GATE sending</li>
<li>Example implementation: sendSingleGate() notifies ONU_i and calls doUpstreamDBA for ONU i+1 (which in turn schedules the next GATE). This is the ONLINE approach... </li>
</ul>

<p>Reimplemented in <a class="el" href="classOLTQPerLLiDBase__P.html#af04ea16877cb5caad13d83b0a1b7a8fb">OLTQPerLLiDBase_P</a>.</p>
<div class="fragment"><pre class="fragment">                                   {
      EV &lt;&lt;<span class="stringliteral">&quot;OLTQPerLLiDBase::DoUpstreamDBA&quot;</span>&lt;&lt;endl;
      <span class="comment">/*</span>
<span class="comment">       * We do not need to allocate for the broadcast</span>
<span class="comment">       * Q on the upstream... so -1. Downstream is</span>
<span class="comment">       * different...</span>
<span class="comment">       */</span>
      <span class="keywordtype">int</span> numOfMACsLLIDs = <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.size()-1;

      <span class="comment">// Check IDLE</span>
      <span class="keywordflow">if</span> (numOfMACsLLIDs == 0) <span class="keywordflow">return</span>;


      <span class="keywordtype">double</span> each_llid = 0;


      <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#ab687a7ea8997f7b21ab977fee6a6dc66">datarateLimit</a> &lt;= 0){
            <span class="comment">// This was the old one, divided all time to num of MACs/LLiDs</span>
            <span class="keywordtype">double</span> slots_per_ml = (double) <a class="code" href="classOLTQPerLLiDBase.html#a97db811dcd4d4306e051b7d2bf2aee21">slotNumber</a>/numOfMACsLLIDs;
            each_llid = slots_per_ml*<a class="code" href="classOLTQPerLLiDBase.html#a8208316cdc8ed31382ff6c52351c29d9">slotLength</a>/16;
      } <span class="keywordflow">else</span>{
            <span class="comment">// NEW!!</span>
            <span class="keywordtype">double</span> superSlotNS = <a class="code" href="classOLTQPerLLiDBase.html#a97db811dcd4d4306e051b7d2bf2aee21">slotNumber</a>*<a class="code" href="classOLTQPerLLiDBase.html#a8208316cdc8ed31382ff6c52351c29d9">slotLength</a>; <span class="comment">// SuperSlot Length in ns</span>
            <span class="keywordtype">double</span> dataratePerSS = ((double)<a class="code" href="classOLTQPerLLiDBase.html#ab687a7ea8997f7b21ab977fee6a6dc66">datarateLimit</a> * superSlotNS ) / pow(10,9); <span class="comment">// bps (NOT Mbps)</span>
            each_llid = ceil(dataratePerSS/(numOfMACsLLIDs*16)); <span class="comment">// ns -&gt; ns16</span>
      }

      <span class="comment">/*</span>
<span class="comment">       *  NOTE: CAUTION:</span>
<span class="comment">       *   - ONUz _should_ handle it correctly (register shift also)</span>
<span class="comment">       *   - CODE FOR REGISTER SHIFT IS IN THE ONUz SO DO NOT CALCULATE IT HERE...</span>
<span class="comment">       */</span>
      uint32_t curpointer=<a class="code" href="classOLTQPerLLiDBase.html#acafc52f42287fda0adda85ebe95bd316">regTimeInt</a>;

      <span class="comment">// For each ONU generate start and length values</span>
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>-&gt;<a class="code" href="classONUTable.html#afed311bc83000140b194059994374b63">getTableSize</a>(); i++){
            <a class="code" href="structcommitedTime.html" title="A struct to hold the start register and the length register for each ONU in the ONUTable.">CommitedTime</a> ct;
            ct.<a class="code" href="structcommitedTime.html#aa6be7083c26c4a5908f2f3b4e8fc23a0">length</a>=each_llid*<a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>-&gt;<a class="code" href="classONUTable.html#aeedba97929cbbc313bf842f76e356673">getEntry</a>(i)-&gt;<a class="code" href="classONUTableEntry.html#ac5f10c076edfc5c4365b095b1d5d95fa">getLLIDsNum</a>();
            ct.<a class="code" href="structcommitedTime.html#a4b792604028c750646faff97a6f9c149">start</a>=curpointer;
            <a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>-&gt;<a class="code" href="classONUTable.html#aeedba97929cbbc313bf842f76e356673">getEntry</a>(i)-&gt;<a class="code" href="classONUTableEntry.html#a956262388edb6c942d01d7b311e68aaa">setComTime</a>(ct);
            curpointer+=each_llid*<a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>-&gt;<a class="code" href="classONUTable.html#aeedba97929cbbc313bf842f76e356673">getEntry</a>(i)-&gt;<a class="code" href="classONUTableEntry.html#ac5f10c076edfc5c4365b095b1d5d95fa">getLLIDsNum</a>();
      }

}
</pre></div>
</div>
</div>
<a class="anchor" id="a05b4aa91883a31fe41f0f03b0ca2ac9c"></a><!-- doxytag: member="OLTQPerLLiDBase::existsInPONQueues" ref="a05b4aa91883a31fe41f0f03b0ca2ac9c" args="(mac_llid ml)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classOLTQPerLLiDBase.html#a05b4aa91883a31fe41f0f03b0ca2ac9c">OLTQPerLLiDBase::existsInPONQueues</a> </td>
          <td>(</td>
          <td class="paramtype">mac_llid&#160;</td>
          <td class="paramname"><em>ml</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                  {
      <span class="comment">// MY FIND...</span>
      <span class="keywordtype">bool</span> found=<span class="keyword">false</span>;
      <span class="keywordflow">for</span>(PonQueues::const_iterator it = <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.begin(); it != <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.end(); ++it)
      {
            <span class="keywordflow">if</span> ((mac_llid)it-&gt;ml == ml) {
                  found=<span class="keyword">true</span>;
                  <span class="keywordflow">break</span>;
            }
      }

      <span class="keywordflow">return</span> found;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad545dae8caa70624543e6070dab784c3"></a><!-- doxytag: member="OLTQPerLLiDBase::findModuleUp" ref="ad545dae8caa70624543e6070dab784c3" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cModule * <a class="el" href="classOLTQPerLLiDBase.html#ad545dae8caa70624543e6070dab784c3">OLTQPerLLiDBase::findModuleUp</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                        {
      cModule *mod = NULL;
      <span class="keywordflow">for</span> (cModule *curmod=<span class="keyword">this</span>; !mod &amp;&amp; curmod; curmod=curmod-&gt;getParentModule())
           mod = curmod-&gt;getSubmodule(name);
      <span class="keywordflow">return</span> mod;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aea4abf74f75dd5a775c7cbe5737814f7"></a><!-- doxytag: member="OLTQPerLLiDBase::finish" ref="aea4abf74f75dd5a775c7cbe5737814f7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#aea4abf74f75dd5a775c7cbe5737814f7">OLTQPerLLiDBase::finish</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                            {
      simtime_t t = simTime();

      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.size(); i++){
            std::string srvName =<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].getServiceName();
            std::string name=srvName +<span class="stringliteral">&quot; BytesDropped&quot;</span>;
            recordScalar(name.c_str(), <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].vec-&gt;numBytesDropped  );
            name=srvName +<span class="stringliteral">&quot; BytesSent&quot;</span>;
            recordScalar(name.c_str(), <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].vec-&gt;numBytesSent  );

            <span class="keywordflow">if</span> (t&gt;0)
            {
                  name=srvName +<span class="stringliteral">&quot; bytes dropped/sec&quot;</span>;
                  recordScalar(name.c_str(), <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].vec-&gt;numBytesDropped/t);
                  name=srvName +<span class="stringliteral">&quot; bytes sent/sec&quot;</span>;
                  recordScalar(name.c_str(), <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].vec-&gt;numBytesSent/t);
            }
      }

      <span class="comment">// Check and Log datarateLimit</span>
      <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#ab687a7ea8997f7b21ab977fee6a6dc66">datarateLimit</a> == 0)
            <a class="code" href="classOLTQPerLLiDBase.html#ab687a7ea8997f7b21ab977fee6a6dc66">datarateLimit</a> = 1000 * pow(10,6);

      recordScalar(<span class="stringliteral">&quot;DataRateLimit&quot;</span>, <a class="code" href="classOLTQPerLLiDBase.html#ab687a7ea8997f7b21ab977fee6a6dc66">datarateLimit</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af22b390c95b2e6e4bef0c46ad4b6a378"></a><!-- doxytag: member="OLTQPerLLiDBase::getFastestLLiDForMac" ref="af22b390c95b2e6e4bef0c46ad4b6a378" args="(const std::string &amp;mac)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t <a class="el" href="classOLTQPerLLiDBase.html#af22b390c95b2e6e4bef0c46ad4b6a378">OLTQPerLLiDBase::getFastestLLiDForMac</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>mac</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                          {

      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.size(); i++){
            <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].ml.mac.str() == mac) <span class="keywordflow">return</span> <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].ml.llid;
      }
      <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a875a2f65e8834a78735355bd2fb4ff31"></a><!-- doxytag: member="OLTQPerLLiDBase::getFastestQForMac" ref="a875a2f65e8834a78735355bd2fb4ff31" args="(const MACAddress &amp;mac)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classQueuePerMacLLid.html">QueuePerMacLLid</a> * <a class="el" href="classOLTQPerLLiDBase.html#a875a2f65e8834a78735355bd2fb4ff31">OLTQPerLLiDBase::getFastestQForMac</a> </td>
          <td>(</td>
          <td class="paramtype">const MACAddress &amp;&#160;</td>
          <td class="paramname"><em>mac</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the higher priority queue for the specified MAC address. </p>
<p>Since Qs are sorted, the first match is returned </p>
<div class="fragment"><pre class="fragment">                                                        {
      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.size(); i++){
            <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].ml.mac.compareTo(mac) == 0)
                  <span class="keywordflow">return</span> &amp;<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i];
      }
      <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acbbe22dca7282fb4a503433128347aea"></a><!-- doxytag: member="OLTQPerLLiDBase::getFastestQForMac" ref="acbbe22dca7282fb4a503433128347aea" args="(const std::string &amp;mac)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classQueuePerMacLLid.html">QueuePerMacLLid</a> * <a class="el" href="classOLTQPerLLiDBase.html#a875a2f65e8834a78735355bd2fb4ff31">OLTQPerLLiDBase::getFastestQForMac</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>mac</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the higher priority queue for the specified MAC address. </p>
<p>Since Qs are sorted, the first match is returned </p>
<div class="fragment"><pre class="fragment">                                                       {

      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.size(); i++){
            <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].ml.mac.str() == mac) <span class="keywordflow">return</span> &amp;<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i];
      }
      <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afc869f34f115c1fc1060058a965e90ca"></a><!-- doxytag: member="OLTQPerLLiDBase::getIndexForLLID" ref="afc869f34f115c1fc1060058a965e90ca" args="(uint16_t llid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classOLTQPerLLiDBase.html#afc869f34f115c1fc1060058a965e90ca">OLTQPerLLiDBase::getIndexForLLID</a> </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>llid</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                 {
      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>.size(); i++)
            <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[i].ml.llid == llid) <span class="keywordflow">return</span> i;

      <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae749241094a6d45b12426ac4c6bf4cd8"></a><!-- doxytag: member="OLTQPerLLiDBase::getSuperSlot_ns" ref="ae749241094a6d45b12426ac4c6bf4cd8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classOLTQPerLLiDBase.html#ae749241094a6d45b12426ac4c6bf4cd8">OLTQPerLLiDBase::getSuperSlot_ns</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the Super Slot length (ns) </p>
<div class="fragment"><pre class="fragment">                                         {
      <span class="keywordflow">return</span> <a class="code" href="classOLTQPerLLiDBase.html#a8208316cdc8ed31382ff6c52351c29d9">slotLength</a>*<a class="code" href="classOLTQPerLLiDBase.html#a97db811dcd4d4306e051b7d2bf2aee21">slotNumber</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3a4b73f411413dbca9945dca09dc12de"></a><!-- doxytag: member="OLTQPerLLiDBase::getSuperSlot_sec" ref="a3a4b73f411413dbca9945dca09dc12de" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classOLTQPerLLiDBase.html#a3a4b73f411413dbca9945dca09dc12de">OLTQPerLLiDBase::getSuperSlot_sec</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the Super Slot length (sec). </p>
<p>Useful for calculating data rates per second. </p>
<div class="fragment"><pre class="fragment">                                        {
      <span class="keywordflow">return</span> ((<span class="keywordtype">double</span>)<a class="code" href="classOLTQPerLLiDBase.html#ae749241094a6d45b12426ac4c6bf4cd8" title="Return the Super Slot length (ns)">getSuperSlot_ns</a>())/pow(10,9);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab62b5af40ff70e244e7ea0b7e5c16384"></a><!-- doxytag: member="OLTQPerLLiDBase::handleMessage" ref="ab62b5af40ff70e244e7ea0b7e5c16384" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#ab62b5af40ff70e244e7ea0b7e5c16384">OLTQPerLLiDBase::handleMessage</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="classOLTQPerLLiDBase__P.html#a4ab5d85c34194d6e7298675232167d68">OLTQPerLLiDBase_P</a>.</p>
<div class="fragment"><pre class="fragment">{

      <span class="comment">// Self Message</span>
      <span class="keywordflow">if</span> (msg-&gt;isSelfMessage())
      {
            EV &lt;&lt; <span class="stringliteral">&quot;Self-message &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; received\n&quot;</span>;
            <span class="keywordflow">if</span> (msg-&gt;getKind() == <a class="code" href="OLTQPerLLiDBase_8h.html#a0ab1b6f17ea122deb8aae1d585655dcd">ONUPENACK</a>)
                  <a class="code" href="classOLTQPerLLiDBase.html#a4d573a9cf345c1571a99a76c8d043c18">handleRegTimeOut</a>(msg);
            <span class="keywordflow">else</span>
                  EV &lt;&lt; <span class="stringliteral">&quot;UnKnown Self Message\n&quot;</span>;

            <span class="keywordflow">return</span>;
      }

      <span class="comment">// Network Message</span>
      cGate *ingate = msg-&gt;getArrivalGate();
      EV &lt;&lt; <span class="stringliteral">&quot;Frame &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; arrived on port &quot;</span> &lt;&lt; ingate-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;...\n&quot;</span>;



      <span class="keywordflow">if</span> (ingate-&gt;getId() ==  gate( <span class="stringliteral">&quot;lowerLayerIn&quot;</span>)-&gt;getId()){
            <a class="code" href="classOLTQPerLLiDBase.html#af79fad010fc8bd1079fb7e9bc74eed70">processFrameFromLowerLayer</a>(msg);
      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ingate-&gt;getId() ==  gate( <span class="stringliteral">&quot;upperLayerIn&quot;</span>)-&gt;getId()){
            <a class="code" href="classOLTQPerLLiDBase.html#a6d6776a7367adb7563036c61828614ff">processFrameFromHigherLayer</a>(msg);
      }<span class="keywordflow">else</span>{
            EV &lt;&lt; <span class="stringliteral">&quot;OLTMacCtl: Message came FROM THE WRONG DIRRECTION???? Dropping\n&quot;</span>;
            <span class="keyword">delete</span> msg;
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac600adb76bc73ad954824a2ecd9c0941"></a><!-- doxytag: member="OLTQPerLLiDBase::handleMPCPReport" ref="ac600adb76bc73ad954824a2ecd9c0941" args="(MPCPReport *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#ac600adb76bc73ad954824a2ecd9c0941">OLTQPerLLiDBase::handleMPCPReport</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMPCPReport.html">MPCPReport</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                     {
      <span class="comment">// Get the bit map... altho in simulation we do not</span>
      <span class="comment">// need it cause we can have the length from the lists</span>
      <span class="comment">//uint8_t bitMap = msg-&gt;getBitMap();</span>

      <span class="comment">// Get entry</span>
      <a class="code" href="classONUTableEntry.html" title="This class holds a single ONUTable entry...">ONUTableEntry</a> * en = <a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>-&gt;<a class="code" href="classONUTable.html#aeedba97929cbbc313bf842f76e356673">getEntry</a>(msg-&gt;getSrc());

      uint64_t totalreq=0;
      <span class="keywordflow">for</span> (uint i=0; i&lt;msg-&gt;<a class="code" href="classMPCPReport.html#a4db1eb1efc9c955b2f7bf048a38c0c76">getQInfoArraySize</a>(); i++){
            <span class="comment">// No need to convert here...  FIXME: hardcoded line rate 1G</span>
            <span class="comment">//en-&gt;req[i] = MPCPTools::ns16ToBits(msg-&gt;getQInfo(i), 1);</span>
            en-&gt;<a class="code" href="classONUTableEntry.html#ac5010b2117184f6925e39029403636c8">req</a>[i] = msg-&gt;<a class="code" href="classMPCPReport.html#a0984e3b8a4187069e0b08623a175986b">getQInfo</a>(i);
            totalreq+=en-&gt;<a class="code" href="classONUTableEntry.html#ac5010b2117184f6925e39029403636c8">req</a>[i];
      }

      en-&gt;<a class="code" href="classONUTableEntry.html#a62888f4821bbb92b28a5b27d0828b6df">totalReq</a> = totalreq;

}
</pre></div>
</div>
</div>
<a class="anchor" id="a4d573a9cf345c1571a99a76c8d043c18"></a><!-- doxytag: member="OLTQPerLLiDBase::handleRegTimeOut" ref="a4d573a9cf345c1571a99a76c8d043c18" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#a4d573a9cf345c1571a99a76c8d043c18">OLTQPerLLiDBase::handleRegTimeOut</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                   {
      <span class="comment">// Find Message Index....</span>
      <span class="keywordflow">for</span> (uint32_t i=0; i&lt;<a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>.size(); i++){
            <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>[i] == msg){
                  EV &lt;&lt; <span class="stringliteral">&quot;OLTMacCtl: ONU request &quot;</span>&lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; TimeOut&quot;</span>&lt;&lt;endl;
                  <span class="comment">// Clear message and tb entry</span>
                  cancelAndDelete((cMessage *)<a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>[i]);
                  <a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>.erase(<a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>.begin()+i);
                  <span class="comment">//temptbl.removeONU(i);</span>
                  <a class="code" href="classOLTQPerLLiDBase.html#a6d23ac5f1c08a034bd27fc1ddec7e831">temptbl</a>.erase(<a class="code" href="classOLTQPerLLiDBase.html#a6d23ac5f1c08a034bd27fc1ddec7e831">temptbl</a>.begin()+i);
            }
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a56f0e4d9c8a7d9177f52d2e24fc32dc4"></a><!-- doxytag: member="OLTQPerLLiDBase::initialize" ref="a56f0e4d9c8a7d9177f52d2e24fc32dc4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#a56f0e4d9c8a7d9177f52d2e24fc32dc4">OLTQPerLLiDBase::initialize</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="classOLTQPerLLiDBase__P.html#a866c1f32bd1a0f1629a9c0e90f27fc35">OLTQPerLLiDBase_P</a>, and <a class="el" href="classOLT__QPL__RR.html#a30a3663847c9f0cda13bb6ff63e658f2">OLT_QPL_RR</a>.</p>
<div class="fragment"><pre class="fragment">{
      <span class="comment">// ONU table</span>
      <a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a> = NULL;
      <a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classONUTable.html" title="A simple class containing a vector of ONUTableEntry objects.">ONUTable</a> *<span class="keyword">&gt;</span>( <a class="code" href="classOLTQPerLLiDBase.html#ad545dae8caa70624543e6070dab784c3">findModuleUp</a>(<span class="stringliteral">&quot;onuTable&quot;</span>));
      <span class="keywordflow">if</span> (!<a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>)
            error(<span class="stringliteral">&quot;Shit... no ONU table found ?!?!&quot;</span>);


      <span class="comment">// Service List</span>
      <a class="code" href="classOLTQPerLLiDBase.html#af3963c88dc900bb37cab7d77470fb85a">serviceList</a>=NULL;
      <span class="keywordflow">if</span> (dynamic_cast&lt;ServiceConfig *&gt;( <a class="code" href="classOLTQPerLLiDBase.html#ad545dae8caa70624543e6070dab784c3">findModuleUp</a>(<span class="stringliteral">&quot;serviceConfig&quot;</span>)) != NULL){
            <a class="code" href="classOLTQPerLLiDBase.html#af3963c88dc900bb37cab7d77470fb85a">serviceList</a> = &amp;(<span class="keyword">dynamic_cast&lt;</span><a class="code" href="classServiceConfig.html" title="A simple module to configure all the services in a scenario and their parameters.">ServiceConfig</a> *<span class="keyword">&gt;</span>( <a class="code" href="classOLTQPerLLiDBase.html#ad545dae8caa70624543e6070dab784c3">findModuleUp</a>(<span class="stringliteral">&quot;serviceConfig&quot;</span>))-&gt;srvs);
      }

      <span class="comment">// Parameters</span>
      <a class="code" href="classOLTQPerLLiDBase.html#a9ea4fc3a41a8f53e87b225f518e7a7a0">regAckTimeOut</a> = par(<span class="stringliteral">&quot;regAckTimeOut&quot;</span>);
      <a class="code" href="classOLTQPerLLiDBase.html#a9ea4fc3a41a8f53e87b225f518e7a7a0">regAckTimeOut</a>/=1000;
      <span class="comment">// in ns</span>
      <a class="code" href="classOLTQPerLLiDBase.html#a8208316cdc8ed31382ff6c52351c29d9">slotLength</a>=par(<span class="stringliteral">&quot;slotLength&quot;</span>);
      <a class="code" href="classOLTQPerLLiDBase.html#a97db811dcd4d4306e051b7d2bf2aee21">slotNumber</a>=par(<span class="stringliteral">&quot;slotNumber&quot;</span>);
      <span class="comment">// Convert to ns16 time</span>
      <span class="comment">// (to be added in the MPCP frames)</span>
      <a class="code" href="classOLTQPerLLiDBase.html#acafc52f42287fda0adda85ebe95bd316">regTimeInt</a> = par(<span class="stringliteral">&quot;regTimeInt&quot;</span>);
      <a class="code" href="classOLTQPerLLiDBase.html#acafc52f42287fda0adda85ebe95bd316">regTimeInt</a>*=(double)1000 / 16;
      <a class="code" href="classOLTQPerLLiDBase.html#a7762bc61444ff9f6a7de825b307465fe">queueLimit</a> = par(<span class="stringliteral">&quot;queueLimit&quot;</span>);

      <span class="comment">// Create Q for BroadCasts</span>
      <a class="code" href="classQueuePerMacLLid.html" title="Allocation per MAC-LLID.">QueuePerMacLLid</a> tmp_qpml;
      tmp_qpml.setServiceName(<span class="stringliteral">&quot;BroadCast&quot;</span>);
      tmp_qpml.prior = 0.0;
      tmp_qpml.<a class="code" href="classQueuePerMacLLid.html#aa106b8124df1194bcc777c3edd6d958b">ml</a>.llid = <a class="code" href="EPON__CtrlInfo_8h.html#a9c30e6b907d649b65497274b020a3537">LLID_EPON_BC</a>;
      <a class="code" href="classOLTQPerLLiDBase.html#a5e35308e217b610871382c48c99f486a" title="Add a new queue to the pon_queues sorted by priority Higher priority Qs go up.">addSortedMacLLID</a>(tmp_qpml);

      <a class="code" href="classOLTQPerLLiDBase.html#ae3e75c9e3058800bee83b9b07c324710">allQsEmpty</a>=<span class="keyword">true</span>;
      <a class="code" href="classOLTQPerLLiDBase.html#a5a5c6a8009ac4e5d596e28be1f05f908">nextQIndex</a> = 0;


      <a class="code" href="classOLTQPerLLiDBase.html#ab687a7ea8997f7b21ab977fee6a6dc66">datarateLimit</a>=(uint64_t)(par(<span class="stringliteral">&quot;datarateLimit&quot;</span>).doubleValue()*pow(10,6));
      <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#ab687a7ea8997f7b21ab977fee6a6dc66">datarateLimit</a>&gt;pow(10,10))
            error(<span class="stringliteral">&quot;Ensure that datarateLimit parameter is not negative...&quot;</span>);


      <span class="comment">// WATCH</span>
      WATCH_VECTOR(<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>);
      WATCH(<a class="code" href="classOLTQPerLLiDBase.html#ae3e75c9e3058800bee83b9b07c324710">allQsEmpty</a>);

      <a class="code" href="classOLTQPerLLiDBase.html#a7b3af2ae6072f4de1709afac5f2beabf" title="Generate and send the initial gate message.">sendMPCPGateReg</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8ef5e93102e04083f7d57a2e029a227d"></a><!-- doxytag: member="OLTQPerLLiDBase::isEmpty" ref="a8ef5e93102e04083f7d57a2e029a227d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classOLTQPerLLiDBase.html#a8ef5e93102e04083f7d57a2e029a227d">OLTQPerLLiDBase::isEmpty</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                             {
      <a class="code" href="classOLTQPerLLiDBase.html#a3c818f0cf98b25bf2932d9bda3778fed" title="Check is all the Qs are empty.">checkIfAllEmpty</a>();
      <span class="keywordflow">return</span> <a class="code" href="classOLTQPerLLiDBase.html#ae3e75c9e3058800bee83b9b07c324710">allQsEmpty</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6d6776a7367adb7563036c61828614ff"></a><!-- doxytag: member="OLTQPerLLiDBase::processFrameFromHigherLayer" ref="a6d6776a7367adb7563036c61828614ff" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#a6d6776a7367adb7563036c61828614ff">OLTQPerLLiDBase::processFrameFromHigherLayer</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                              {
      EV &lt;&lt; <span class="stringliteral">&quot;OLT_Q_mgmt_PerLLiD: Incoming from higher layer...\n&quot;</span>;

      <span class="comment">/*</span>
<span class="comment">       * Notify the lower layer.</span>
<span class="comment">       */</span>
      <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#ae3e75c9e3058800bee83b9b07c324710">allQsEmpty</a>){
            EV &lt;&lt; <span class="stringliteral">&quot;Direct tx: &quot;</span>&lt;&lt;msg&lt;&lt;endl;
            send(msg, <span class="stringliteral">&quot;lowerLayerOut&quot;</span>);
            <span class="keywordflow">return</span>;
      }

      <a class="code" href="classEPON__LLidCtrlInfo.html" title="EPON_LLidCtrlInfo extends cObject and is used for ControlInfo carried in the messages.">EPON_LLidCtrlInfo</a> *nfo = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classEPON__LLidCtrlInfo.html" title="EPON_LLidCtrlInfo extends cObject and is used for ControlInfo carried in the messages.">EPON_LLidCtrlInfo</a> *<span class="keyword">&gt;</span>(msg-&gt;getControlInfo());

      <span class="comment">// If frame has no info or is BC add to the BroadCast Q</span>
      <span class="keywordtype">int</span> Q_index=-1;
      <span class="keywordflow">if</span> (!nfo || nfo-&gt;<a class="code" href="classEPON__LLidCtrlInfo.html#a22816820608cef4293a7c296d3de8734">llid</a> == <a class="code" href="EPON__CtrlInfo_8h.html#a9c30e6b907d649b65497274b020a3537">LLID_EPON_BC</a>){
            Q_index = <a class="code" href="classOLTQPerLLiDBase.html#afc869f34f115c1fc1060058a965e90ca">getIndexForLLID</a>(<a class="code" href="EPON__CtrlInfo_8h.html#a9c30e6b907d649b65497274b020a3537">LLID_EPON_BC</a>);
      }<span class="keywordflow">else</span>{
            Q_index = <a class="code" href="classOLTQPerLLiDBase.html#afc869f34f115c1fc1060058a965e90ca">getIndexForLLID</a>(nfo-&gt;<a class="code" href="classEPON__LLidCtrlInfo.html#a22816820608cef4293a7c296d3de8734">llid</a>);
      }

      <span class="comment">// Check if we can forward frame</span>
      <span class="keywordflow">if</span> (Q_index == -1){
            EV &lt;&lt; <span class="stringliteral">&quot;*** WRONG LLID : DROPPING&quot;</span> &lt;&lt;endl;
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
      }

      <span class="comment">// Update the incoming rate BEFORE discarding message</span>
      <span class="comment">// in case the Q is full.</span>
      cPacket *pkt = <span class="keyword">dynamic_cast&lt;</span>cPacket *<span class="keyword">&gt;</span>(msg);
      <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[Q_index].vec-&gt;numIncomingBits+=pkt-&gt;getBitLength();

      <span class="comment">// Check that is not full</span>
      <span class="keywordflow">if</span> (<a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[Q_index].length() &gt;= <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[Q_index].<a class="code" href="classOLTQPerLLiDBase.html#a7762bc61444ff9f6a7de825b307465fe">queueLimit</a>){
            <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[Q_index].vec-&gt;numBytesDropped+=pkt-&gt;getByteLength();
            <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[Q_index].vec-&gt;recordVectors();
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
      }<span class="keywordflow">else</span>{
            <span class="comment">// Record the incoming bytes</span>
            <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[Q_index].vec-&gt;recordVectors();
      }
      <span class="comment">// Add it</span>
      <a class="code" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">pon_queues</a>[Q_index].insert(dynamic_cast&lt;cPacket *&gt;(msg));



}
</pre></div>
</div>
</div>
<a class="anchor" id="af79fad010fc8bd1079fb7e9bc74eed70"></a><!-- doxytag: member="OLTQPerLLiDBase::processFrameFromLowerLayer" ref="af79fad010fc8bd1079fb7e9bc74eed70" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#af79fad010fc8bd1079fb7e9bc74eed70">OLTQPerLLiDBase::processFrameFromLowerLayer</a> </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                             {
      EV &lt;&lt; <span class="stringliteral">&quot;OLT_Q_mgmt_PerLLiD: Incoming from lower layer\n&quot;</span>;

      EthernetIIFrame * frame = <span class="keyword">dynamic_cast&lt;</span>EthernetIIFrame *<span class="keyword">&gt;</span>(msg);
      <span class="keywordflow">if</span> (frame &amp;&amp; frame-&gt;getEtherType() == <a class="code" href="MPCP__codes_8h.html#a01d93522186165aff8e9d9907b04aec3">MPCP_TYPE</a>){
            <a class="code" href="classOLTQPerLLiDBase.html#afd30699aca06198af9f2b4bc6c97363b" title="Do MPCP stuff.">processMPCP</a>(frame);
            <span class="keywordflow">return</span>;
      }

      <span class="comment">// Not Control</span>
      send(msg,<span class="stringliteral">&quot;upperLayerOut&quot;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="afd30699aca06198af9f2b4bc6c97363b"></a><!-- doxytag: member="OLTQPerLLiDBase::processMPCP" ref="afd30699aca06198af9f2b4bc6c97363b" args="(EthernetIIFrame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#afd30699aca06198af9f2b4bc6c97363b">OLTQPerLLiDBase::processMPCP</a> </td>
          <td>(</td>
          <td class="paramtype">EthernetIIFrame *&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Do <a class="el" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> stuff. </p>
<p>This handles the ONU registration and REPORT messages </p>
<div class="fragment"><pre class="fragment">                                                        {
      EV &lt;&lt; <span class="stringliteral">&quot;OLTMacCtl: MPCP Frame processing\n&quot;</span>;
      <a class="code" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> * mpcp = check_and_cast&lt;<a class="code" href="classMPCP.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCP</a> *&gt;(frame);
      <span class="keywordflow">switch</span> (mpcp-&gt;<a class="code" href="classMPCP.html#a68374d0a62fbdd1c40f264f1a9a9230b">getOpcode</a>())
      {
            <span class="keywordflow">case</span> <a class="code" href="MPCP__codes_8h.html#a312e8c091a60aceac2ce2736d703fde5">MPCP_REGREQ</a>:
            {
                  <a class="code" href="classMPCPRegReq.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPRegReq</a> * req = check_and_cast&lt;<a class="code" href="classMPCPRegReq.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPRegReq</a> *&gt;(frame);
                  <a class="code" href="classMPCPRegister.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPRegister</a> *rspframe = <span class="keyword">new</span> <a class="code" href="classMPCPRegister.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPRegister</a>();
                  rspframe-&gt;setOpcode(<a class="code" href="MPCP__codes_8h.html#ab52e72f4e759864e6bc6792412caa7f5">MPCP_REGISTER</a>);
                  rspframe-&gt;setName(<span class="stringliteral">&quot;MPCPRegister&quot;</span>);
                  rspframe-&gt;setEtherType(<a class="code" href="MPCP__codes_8h.html#a01d93522186165aff8e9d9907b04aec3">MPCP_TYPE</a>);
                  rspframe-&gt;setDest(req-&gt;getSrc());
                  rspframe-&gt;setPtpNumReg(req-&gt;<a class="code" href="classMPCPRegReq.html#afe629188e375ac54dc6df080a78f779e">getPtpNumReq</a>());

                  EV &lt;&lt; <span class="stringliteral">&quot;Log the LLIDs temporarly and add a TO timer\n&quot;</span>;

                  <a class="code" href="classONUTableEntry.html" title="This class holds a single ONUTable entry...">ONUTableEntry</a> te;
                  te.<a class="code" href="classONUTableEntry.html#ad2a465087122fb0c1a99a90fe31dfaa7">setId</a>(req-&gt;getSrc());
                  <span class="comment">// Parse and set LLIDS</span>
                  rspframe-&gt;setLLIDsArraySize(req-&gt;<a class="code" href="classMPCPRegReq.html#afe629188e375ac54dc6df080a78f779e">getPtpNumReq</a>());

                  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;req-&gt;<a class="code" href="classMPCPRegReq.html#afe629188e375ac54dc6df080a78f779e">getPtpNumReq</a>(); i++){
                        <span class="comment">// 0xFFF = 4095 intrand -&gt; [0-4095)</span>
                        uint32_t llid_tmp=(uint32_t)intrand(4095);
                        <span class="keywordflow">while</span> (te.<a class="code" href="classONUTableEntry.html#a72689aa04d7c1e16fde917207a550681" title="Check the LLID is unique and add.">addLLID</a>(llid_tmp) &lt;0 ){
                              EV &lt;&lt; <span class="stringliteral">&quot;*** RANDOM GEN FAILED!!!!???\n&quot;</span>;
                              llid_tmp=(uint32_t)intrand(4095);
                        }

                        rspframe-&gt;setLLIDs(i,llid_tmp);
                  }

                  rspframe-&gt;setByteLength(<a class="code" href="MPCP__codes_8h.html#a53a5bdadb1af2c43add7d5e29f2b6d11">MPCP_HEADER_LEN</a>+<a class="code" href="MPCP__codes_8h.html#ac5c8425296d0d597cc31602ae00ee1c1">MPCP_LIST_LEN</a>+req-&gt;<a class="code" href="classMPCPRegReq.html#afe629188e375ac54dc6df080a78f779e">getPtpNumReq</a>()*<a class="code" href="MPCP__codes_8h.html#ada6dcf058a919459762e5154ea64f23b">MPCP_LLID_LEN</a>);

                  <span class="comment">// TODO: add TimeStamp!</span>
                  <a class="code" href="classOLTQPerLLiDBase.html#a6d23ac5f1c08a034bd27fc1ddec7e831">temptbl</a>.push_back(te);


                  <span class="comment">// NOTE: do NOT send... enqueue</span>
                  <span class="comment">//send(rspframe,&quot;lowerLayerOut&quot;);</span>
                  <a class="code" href="classOLTQPerLLiDBase.html#a6d6776a7367adb7563036c61828614ff">processFrameFromHigherLayer</a>(rspframe);

                  <span class="comment">// Create and add TO self message</span>
                  cMessage *tmpmsg=<span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;OnuTOMsg&quot;</span>, <a class="code" href="OLTQPerLLiDBase_8h.html#a0ab1b6f17ea122deb8aae1d585655dcd">ONUPENACK</a>);
                  <a class="code" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">pendingAck</a>.push_back(tmpmsg);
                  scheduleAt(simTime()+<a class="code" href="classOLTQPerLLiDBase.html#a9ea4fc3a41a8f53e87b225f518e7a7a0">regAckTimeOut</a>, tmpmsg);

                  <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="MPCP__codes_8h.html#a5c088b9851d17a5099e83549071388cd">MPCP_REGACK</a>:
            {
                  <a class="code" href="classOLTQPerLLiDBase.html#a7c35ae769a03b76bbe8126e51d0a14da">doOnuRegistration</a>(mpcp-&gt;getSrc());
                  <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <a class="code" href="MPCP__codes_8h.html#ac549493bf4e9303c1e0e090133f065ec">MPCP_REPORT</a>:
            {
                  <a class="code" href="classMPCPReport.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPReport</a> * rep = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classMPCPReport.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPReport</a> *<span class="keyword">&gt;</span>(frame);
                  <a class="code" href="classOLTQPerLLiDBase.html#ac600adb76bc73ad954824a2ecd9c0941">handleMPCPReport</a>(rep);
                  <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">default</span>:
                  EV &lt;&lt; <span class="stringliteral">&quot;Unrecognized MPCP OpCode&quot;</span>;
      };

      <span class="keyword">delete</span> frame;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5fd4b38cc1e85328f59d3880533f95dd"></a><!-- doxytag: member="OLTQPerLLiDBase::SendGateUpdates" ref="a5fd4b38cc1e85328f59d3880533f95dd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#a5fd4b38cc1e85328f59d3880533f95dd">OLTQPerLLiDBase::SendGateUpdates</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generate <a class="el" href="classMPCPGate.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPGate</a> messages announcing the transmission times to the ONUs. </p>
<p>(For all the ONUs in the <a class="el" href="classONUTable.html" title="A simple class containing a vector of ONUTableEntry objects.">ONUTable</a>)</p>
<p>This method should be called at the end of DoUpstreamDBA ONLY is the algorithm is NON-POLLING (burst) BASED. Polling algorithms have to override the DoUpstreamDBA to handle both allocation and GATE/GRANDs... </p>

<p>Reimplemented in <a class="el" href="classOLTQPerLLiDBase__P.html#ae70d665135b604f9cac1ca5706ad2030">OLTQPerLLiDBase_P</a>.</p>
<div class="fragment"><pre class="fragment">                                     {

      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=<a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>-&gt;<a class="code" href="classONUTable.html#afed311bc83000140b194059994374b63">getTableSize</a>()-1; i&gt;=0; i--){
            <a class="code" href="classMPCPGate.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPGate</a> *gt = <span class="keyword">new</span> <a class="code" href="classMPCPGate.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPGate</a>();
            gt-&gt;setName(<span class="stringliteral">&quot;MPCPGate&quot;</span>);
            gt-&gt;setEtherType(<a class="code" href="MPCP__codes_8h.html#a01d93522186165aff8e9d9907b04aec3">MPCP_TYPE</a>);
            gt-&gt;<a class="code" href="classMPCP.html#ac16411714bb8f9b3f4bc9e4fc88ae17f">setOpcode</a>(<a class="code" href="MPCP__codes_8h.html#a190716814784e1e13cfd09ef6e773f5d">MPCP_GATE</a>);
            <a class="code" href="classMPCPTools.html#a1492dd6adbfd7d567a3ed6621ab0991c">MPCPTools::setGateLen</a>(*gt, 1);

            gt-&gt;<a class="code" href="classMPCPGate.html#a5ecaa1ee9b5653aa54d2411a0e1fde35">setSlotTime</a>(<a class="code" href="classOLTQPerLLiDBase.html#a8208316cdc8ed31382ff6c52351c29d9">slotLength</a>);
            gt-&gt;<a class="code" href="classMPCPGate.html#af0e5361a85dab838136070bcee24e8c5">setSlotsNum</a>(<a class="code" href="classOLTQPerLLiDBase.html#a97db811dcd4d4306e051b7d2bf2aee21">slotNumber</a>);

            gt-&gt;setDest(<a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>-&gt;<a class="code" href="classONUTable.html#aeedba97929cbbc313bf842f76e356673">getEntry</a>(i)-&gt;<a class="code" href="classONUTableEntry.html#acd4a5a20f01a363c305ea401e5473555">getId</a>());
            gt-&gt;<a class="code" href="classMPCPGate.html#a840d508505c37f320a26fa9c60212ee4">setStartTime</a>(0, <a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>-&gt;<a class="code" href="classONUTable.html#aeedba97929cbbc313bf842f76e356673">getEntry</a>(i)-&gt;<a class="code" href="classONUTableEntry.html#a52a4c17a0ff95becf1a25e30bb40e2d2">getComTime</a>().<a class="code" href="structcommitedTime.html#a4b792604028c750646faff97a6f9c149">start</a>);
            gt-&gt;<a class="code" href="classMPCPGate.html#a8bccbe88a8094888b8f37f99cb78af11">setDuration</a>(0, <a class="code" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">onutbl</a>-&gt;<a class="code" href="classONUTable.html#aeedba97929cbbc313bf842f76e356673">getEntry</a>(i)-&gt;<a class="code" href="classONUTableEntry.html#a52a4c17a0ff95becf1a25e30bb40e2d2">getComTime</a>().<a class="code" href="structcommitedTime.html#aa6be7083c26c4a5908f2f3b4e8fc23a0">length</a>);

            <span class="comment">// Header + List + (start + Len) + slotNum + slotLen</span>
            gt-&gt;setByteLength(<a class="code" href="MPCP__codes_8h.html#a53a5bdadb1af2c43add7d5e29f2b6d11">MPCP_HEADER_LEN</a>+<a class="code" href="MPCP__codes_8h.html#ac5c8425296d0d597cc31602ae00ee1c1">MPCP_LIST_LEN</a>+<a class="code" href="MPCP__codes_8h.html#a119292575b8af22648a8d1ebfae4c2cd">MPCP_TIMERS_LEN</a>+<a class="code" href="MPCP__codes_8h.html#a53fb660b1ef07c3453c9e5dc9bea14b3">MPCP_SLOTINFO_LEN</a>);


            <span class="comment">// Send directly</span>
            send(gt, <span class="stringliteral">&quot;lowerLayerOut&quot;</span>);
      }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7b3af2ae6072f4de1709afac5f2beabf"></a><!-- doxytag: member="OLTQPerLLiDBase::sendMPCPGateReg" ref="a7b3af2ae6072f4de1709afac5f2beabf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOLTQPerLLiDBase.html#a7b3af2ae6072f4de1709afac5f2beabf">OLTQPerLLiDBase::sendMPCPGateReg</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generate and send the initial gate message. </p>
<p>This message is used for the registration of the ONUs. </p>
<div class="fragment"><pre class="fragment">                                     {
      <a class="code" href="classMPCPGate.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPGate</a> *gt = <span class="keyword">new</span> <a class="code" href="classMPCPGate.html" title="Class generated from common/EPON_messages.msg by opp_msgc.">MPCPGate</a>();
      gt-&gt;setEtherType(<a class="code" href="MPCP__codes_8h.html#a01d93522186165aff8e9d9907b04aec3">MPCP_TYPE</a>);
      gt-&gt;<a class="code" href="classMPCP.html#ac16411714bb8f9b3f4bc9e4fc88ae17f">setOpcode</a>(<a class="code" href="MPCP__codes_8h.html#a190716814784e1e13cfd09ef6e773f5d">MPCP_GATE</a>);
      gt-&gt;setName(<span class="stringliteral">&quot;MPCPGate(Reg)&quot;</span>);
      <a class="code" href="classMPCPTools.html#a1492dd6adbfd7d567a3ed6621ab0991c">MPCPTools::setGateLen</a>(*gt, 1);

      gt-&gt;<a class="code" href="classMPCPGate.html#a8bccbe88a8094888b8f37f99cb78af11">setDuration</a>(0, <a class="code" href="classOLTQPerLLiDBase.html#acafc52f42287fda0adda85ebe95bd316">regTimeInt</a>);
      gt-&gt;setDest(MACAddress::BROADCAST_ADDRESS);
      gt-&gt;<a class="code" href="classMPCPGate.html#a5ecaa1ee9b5653aa54d2411a0e1fde35">setSlotTime</a>(<a class="code" href="classOLTQPerLLiDBase.html#a8208316cdc8ed31382ff6c52351c29d9">slotLength</a>);
      gt-&gt;<a class="code" href="classMPCPGate.html#af0e5361a85dab838136070bcee24e8c5">setSlotsNum</a>(<a class="code" href="classOLTQPerLLiDBase.html#a97db811dcd4d4306e051b7d2bf2aee21">slotNumber</a>);

      <span class="comment">// Header + List + (start + Len) + slotNum + slotLen</span>
      gt-&gt;setByteLength(<a class="code" href="MPCP__codes_8h.html#a53a5bdadb1af2c43add7d5e29f2b6d11">MPCP_HEADER_LEN</a>+<a class="code" href="MPCP__codes_8h.html#ac5c8425296d0d597cc31602ae00ee1c1">MPCP_LIST_LEN</a>+<a class="code" href="MPCP__codes_8h.html#a119292575b8af22648a8d1ebfae4c2cd">MPCP_TIMERS_LEN</a>+<a class="code" href="MPCP__codes_8h.html#a53fb660b1ef07c3453c9e5dc9bea14b3">MPCP_SLOTINFO_LEN</a>);

      send(gt, <span class="stringliteral">&quot;lowerLayerOut&quot;</span>);

}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ae3e75c9e3058800bee83b9b07c324710"></a><!-- doxytag: member="OLTQPerLLiDBase::allQsEmpty" ref="ae3e75c9e3058800bee83b9b07c324710" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classOLTQPerLLiDBase.html#ae3e75c9e3058800bee83b9b07c324710">OLTQPerLLiDBase::allQsEmpty</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab687a7ea8997f7b21ab977fee6a6dc66"></a><!-- doxytag: member="OLTQPerLLiDBase::datarateLimit" ref="ab687a7ea8997f7b21ab977fee6a6dc66" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classOLTQPerLLiDBase.html#ab687a7ea8997f7b21ab977fee6a6dc66">OLTQPerLLiDBase::datarateLimit</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5a5c6a8009ac4e5d596e28be1f05f908"></a><!-- doxytag: member="OLTQPerLLiDBase::nextQIndex" ref="a5a5c6a8009ac4e5d596e28be1f05f908" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classOLTQPerLLiDBase.html#a5a5c6a8009ac4e5d596e28be1f05f908">OLTQPerLLiDBase::nextQIndex</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7265c34235b861daf6e34cd9bb8a35e6"></a><!-- doxytag: member="OLTQPerLLiDBase::onutbl" ref="a7265c34235b861daf6e34cd9bb8a35e6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classONUTable.html">ONUTable</a>* <a class="el" href="classOLTQPerLLiDBase.html#a7265c34235b861daf6e34cd9bb8a35e6">OLTQPerLLiDBase::onutbl</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aca076b309243ff57ea00b74562cd85a2"></a><!-- doxytag: member="OLTQPerLLiDBase::pendingAck" ref="aca076b309243ff57ea00b74562cd85a2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;cMessage *&gt; <a class="el" href="classOLTQPerLLiDBase.html#aca076b309243ff57ea00b74562cd85a2">OLTQPerLLiDBase::pendingAck</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a8e730aa4d85cdfcca713e314766a69df"></a><!-- doxytag: member="OLTQPerLLiDBase::pon_queues" ref="a8e730aa4d85cdfcca713e314766a69df" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classOLTQPerLLiDBase.html#a9ea8edadd43bff7481f16930d6a6a999">PonQueues</a> <a class="el" href="classOLTQPerLLiDBase.html#a8e730aa4d85cdfcca713e314766a69df">OLTQPerLLiDBase::pon_queues</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7762bc61444ff9f6a7de825b307465fe"></a><!-- doxytag: member="OLTQPerLLiDBase::queueLimit" ref="a7762bc61444ff9f6a7de825b307465fe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classOLTQPerLLiDBase.html#a7762bc61444ff9f6a7de825b307465fe">OLTQPerLLiDBase::queueLimit</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9ea4fc3a41a8f53e87b225f518e7a7a0"></a><!-- doxytag: member="OLTQPerLLiDBase::regAckTimeOut" ref="a9ea4fc3a41a8f53e87b225f518e7a7a0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classOLTQPerLLiDBase.html#a9ea4fc3a41a8f53e87b225f518e7a7a0">OLTQPerLLiDBase::regAckTimeOut</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acafc52f42287fda0adda85ebe95bd316"></a><!-- doxytag: member="OLTQPerLLiDBase::regTimeInt" ref="acafc52f42287fda0adda85ebe95bd316" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="classOLTQPerLLiDBase.html#acafc52f42287fda0adda85ebe95bd316">OLTQPerLLiDBase::regTimeInt</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af3963c88dc900bb37cab7d77470fb85a"></a><!-- doxytag: member="OLTQPerLLiDBase::serviceList" ref="af3963c88dc900bb37cab7d77470fb85a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ServiceConfig_8h.html#aaf9dfd93fb9195bd4743e76b1a1ed879">SrvList</a>* <a class="el" href="classOLTQPerLLiDBase.html#af3963c88dc900bb37cab7d77470fb85a">OLTQPerLLiDBase::serviceList</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a8208316cdc8ed31382ff6c52351c29d9"></a><!-- doxytag: member="OLTQPerLLiDBase::slotLength" ref="a8208316cdc8ed31382ff6c52351c29d9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t <a class="el" href="classOLTQPerLLiDBase.html#a8208316cdc8ed31382ff6c52351c29d9">OLTQPerLLiDBase::slotLength</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a97db811dcd4d4306e051b7d2bf2aee21"></a><!-- doxytag: member="OLTQPerLLiDBase::slotNumber" ref="a97db811dcd4d4306e051b7d2bf2aee21" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t <a class="el" href="classOLTQPerLLiDBase.html#a97db811dcd4d4306e051b7d2bf2aee21">OLTQPerLLiDBase::slotNumber</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a6d23ac5f1c08a034bd27fc1ddec7e831"></a><!-- doxytag: member="OLTQPerLLiDBase::temptbl" ref="a6d23ac5f1c08a034bd27fc1ddec7e831" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;<a class="el" href="classONUTableEntry.html">ONUTableEntry</a>&gt; <a class="el" href="classOLTQPerLLiDBase.html#a6d23ac5f1c08a034bd27fc1ddec7e831">OLTQPerLLiDBase::temptbl</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="OLTQPerLLiDBase_8h.html">OLTQPerLLiDBase.h</a></li>
<li><a class="el" href="OLTQPerLLiDBase_8cc.html">OLTQPerLLiDBase.cc</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classOLTQPerLLiDBase.html">OLTQPerLLiDBase</a>      </li>

    <li class="footer">Generated on Wed Oct 31 2012 20:10:51 for EPONImplementationforOMNet++ by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
